<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>CodeThink</title>
  <subtitle>Thoughts on Life and Code</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://codethink.me/"/>
  <updated>2017-05-28T03:01:40.000Z</updated>
  <id>http://codethink.me/</id>
  
  <author>
    <name>Archie Yang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>使用throttleFirst解决按钮多次响应的问题</title>
    <link href="http://codethink.me/2015/12/20/using-throttlefirst-to-avoid-double-tap/"/>
    <id>http://codethink.me/2015/12/20/using-throttlefirst-to-avoid-double-tap/</id>
    <published>2015-12-20T02:01:58.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>#0. 前言<br>本文是<a href="http://codethink.me/categories/Real-World-RxJava/">Real World RxJava</a>系列的第一篇，这个系列主要介绍如何使用RxJava解决Android开发中的一些实际问题。如果你还不了解RxJava的基本概念（Observable, Subscriber, Subscription等），建议先阅读<a href="http://codethink.me/2015/05/09/intro-of-rxjava/">RxJava初探</a>。</p>
<p>#1. 问题描述<br>我们首先实现一个Android中最常见的点击按钮，弹出一个新的Fragment的效果，其代码如下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">   </div><div class="line">findViewById(R.id.normal_button).setOnClickListener(view -&gt; &#123;</div><div class="line">    FragmentTransaction transaction = getFragmentManager().beginTransaction();</div><div class="line">    transaction</div><div class="line">            .setCustomAnimations(R.animator.slide_up, R.animator.slide_down, R.animator.slide_up, R.animator.slide_down)</div><div class="line">            .setTransition(FragmentTransaction.TRANSIT_FRAGMENT_OPEN);</div><div class="line"></div><div class="line">    transaction</div><div class="line">            .add(android.R.id.content, <span class="keyword">new</span> DummyFragment())</div><div class="line">            .addToBackStack(DummyFragment.class.getSimpleName()).commit();</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>这段代码存在的问题在于当用户无意中多次点击到按钮时，会弹出多个Fragment，如图所示。<br><img src="/images/double-tap-issue.gif" alt=""><br><a id="more"></a></p>
<p>#2. 解决方案<br>我们通过使用<a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html#throttleFirst(long,%20java.util.concurrent.TimeUnit)" target="_blank" rel="external">throttleFirst</a>操作符来解决按钮被多次点击的问题。throttleFirst允许设置一个时间长度，之后它会发送固定时间长度内的第一个事件，而屏蔽其它事件，在间隔达到设置的时间后，可以再发送下一个事件，如下图所示。<br><img src="/images/throttleFirst.png" alt=""><br>同时，我们使用<a href="https://github.com/JakeWharton/RxBinding" target="_blank" rel="external">RxBinding</a>将点击事件转化为一个Observable，将上述间隔时间设置为动画时间，这样，在点击按钮后只会弹出一个Fragment，避免了多次响应的问题。完整代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Button throttleFirstButton = (Button) findViewById(R.id.throttle_first_button);</div><div class="line">RxView.clicks(throttleFirstButton)</div><div class="line">        .throttleFirst(ANIMATION_TIME, TimeUnit.MILLISECONDS)</div><div class="line">        .subscribe(aVoid -&gt; &#123;</div><div class="line">            FragmentTransaction transaction = getFragmentManager().beginTransaction();</div><div class="line">            transaction</div><div class="line">                    .setCustomAnimations(R.animator.slide_up, R.animator.slide_down, R.animator.slide_up, R.animator.slide_down)</div><div class="line">                    .setTransition(FragmentTransaction.TRANSIT_FRAGMENT_OPEN);</div><div class="line"></div><div class="line">            transaction</div><div class="line">                    .add(android.R.id.content, <span class="keyword">new</span> DummyFragment())</div><div class="line">                    .addToBackStack(DummyFragment.class.getSimpleName()).commit();</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<p>#参考</p>
<ol>
<li><a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html#throttleFirst(long,%20java.util.concurrent.TimeUnit)" target="_blank" rel="external">http://reactivex.io/RxJava/javadoc/rx/Observable.html#throttleFirst(long,%20java.util.concurrent.TimeUnit)</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#0. 前言&lt;br&gt;本文是&lt;a href=&quot;http://codethink.me/categories/Real-World-RxJava/&quot;&gt;Real World RxJava&lt;/a&gt;系列的第一篇，这个系列主要介绍如何使用RxJava解决Android开发中的一些实际问题。如果你还不了解RxJava的基本概念（Observable, Subscriber, Subscription等），建议先阅读&lt;a href=&quot;http://codethink.me/2015/05/09/intro-of-rxjava/&quot;&gt;RxJava初探&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;#1. 问题描述&lt;br&gt;我们首先实现一个Android中最常见的点击按钮，弹出一个新的Fragment的效果，其代码如下。&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;   &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;findViewById(R.id.normal_button).setOnClickListener(view -&amp;gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    FragmentTransaction transaction = getFragmentManager().beginTransaction();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    transaction&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .setCustomAnimations(R.animator.slide_up, R.animator.slide_down, R.animator.slide_up, R.animator.slide_down)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .setTransition(FragmentTransaction.TRANSIT_FRAGMENT_OPEN);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    transaction&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .add(android.R.id.content, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DummyFragment())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .addToBackStack(DummyFragment.class.getSimpleName()).commit();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这段代码存在的问题在于当用户无意中多次点击到按钮时，会弹出多个Fragment，如图所示。&lt;br&gt;&lt;img src=&quot;/images/double-tap-issue.gif&quot; alt=&quot;&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Real World RxJava" scheme="http://codethink.me/categories/Real-World-RxJava/"/>
    
    
      <category term="Android" scheme="http://codethink.me/tags/Android/"/>
    
      <category term="RxJava" scheme="http://codethink.me/tags/RxJava/"/>
    
      <category term="RxBinding" scheme="http://codethink.me/tags/RxBinding/"/>
    
  </entry>
  
  <entry>
    <title>[译]Tell, Don&#39;t Ask</title>
    <link href="http://codethink.me/2015/08/22/tell-dont-ask/"/>
    <id>http://codethink.me/2015/08/22/tell-dont-ask/</id>
    <published>2015-08-22T03:44:38.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>原文链接：<a href="https://pragprog.com/articles/tell-dont-ask" target="_blank" rel="external">Tell, Don’t Ask</a></p>
<p>Alec Sharp在其最近的书Smalltalk by Example[1]中指出了一个极有价值的观点：</p>
<p><em>过程化的代码获取信息并做出决定。面向对象的代码只是告诉对象去做。<br>— Alec Sharp</em></p>
<p>这意味着，你应该尝试直接告诉对象你希望他们去做什么，而不是询问他们的状态，做出决定，再告诉他们去做什么。</p>
<p>这样做的问题是，作为调用者，你不应该根据你获得的被调用对象的状态来做决定, 然后再去改变对象的状态。你实现的这部分逻辑很可能是被调用对象的职责，而不是你的。由你来在对象外部做出决定破坏了它的封装。</p>
<p>当然，你可以说，这是显然的。我从来不会写那样的代码。然而，我们仍然会通过检验一些引用对象，并根据不同的返回值调用不同的方法。但是这也许不是最好的做法。告诉对象你要什么，由它来决定如何做。要用声明式的思考方式，而不是过程式的！<br><a id="more"></a></p>
<p>#仅仅得到数据<br>这种实践的主要目的是确保任务被分配到了正确的类型中的正确的函数的正确功能中，避免引入和于其他类型额外的耦合。</p>
<p>这里最危险的信号是向一个对象请求数据，而你仅仅得到了数据。你得到的不是一个对象，至少在很大意义上不是。尽管你查询得到的是一个结构意义上的对象（比如一个String），它在语义上已经不是一个对象的。它和拥有它的对象已经失去了关联。你得到了一个内容是”RED”的字符串，但是你无法从这个字符串中获得它的实际意义。它是拥有者的姓？是车的颜色？是当前测速表的状态？一个对象知道这些信息，而数据不知道。</p>
<p>面向对象编程的基础原则是统一方法和数据。讲这两者分开会将你带回到面向过程编程。</p>
<p>#不变序列是不够的<br>每一个类中都存在不变序列－那些永远为真的条件。某些语言（比如Eiffel）直接提供定义和检查不变序列的支持。大多数语言没有，但这只是因为这些不变序列没有被显式的说明—他们仍然存在。比如，一个迭代器有如下的不变序列（这里使用Java描述）：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">hasMoreElements() == <span class="keyword">true</span></div><div class="line"><span class="comment">// 意味着</span></div><div class="line">nextElement()             </div><div class="line"><span class="comment">// 会有返回值</span></div></pre></td></tr></table></figure><br>换句话说，如果hasMoreElements()返回true，获取下一个元素的操作一定会成功，否则一定是发生了错误。如果你在没有同步机制（加锁）的情况下运行多线程的代码，可能导致上面的不变序列失败：某个线程在你操作前拿走了最后一个元素。</p>
<p>不变序列不成立，所以一定哪里出错了—出现bug了。</p>
<p>根据契约式设计原则，如果你的方法（查询和命令）可以被自由混合并且你的不变序列无法被打破，一切就是安全的。但是在你维护类型的不变序列时，根据你暴露的状态的多少，你可能会极大的增加调用者和被调用者的耦合。</p>
<p>例如，假设你有一个容器对象c。你可能会暴露这个容器中包含的对象的迭代器，正像JDK core那样，或者你也可以提供一个允许某个函数在集合中所有成员上运行一遍的方法。在Java中你可以这样声明：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Applyable</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">each</span><span class="params">(Object anObject)</span></span>;</div><div class="line">&#125;</div><div class="line"> ...</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">apply</span><span class="params">(Applyable)</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//调用时：</span></div><div class="line">SomeClass foo;</div><div class="line">...</div><div class="line">foo.apply(<span class="keyword">new</span> Applyable() &#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">each</span><span class="params">(Object anObject)</span> </span>&#123;</div><div class="line">         <span class="comment">// do what you want to anObject </span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><br>（原谅这个奇怪的“Apply-able”，我们发现用“-able”后缀命名interface十分便捷，但是在这里英语词汇似乎不太够用）</p>
<p>对于带有函数指针的语言来说，实现这个会容易很多。对于像Perl和Smalltalk这样自带这个概念的语言来说更加容易。但是你应该能明白这里的意思：在容器里所有的条目上运行这个方法，我不在乎这是怎么实现的。</p>
<p>无论使用apply还是迭代器，你都会得到相同的结果。如何选择完全取决于你能接受多大程度的耦合：为了减少耦合，需要尽可能少的暴露状态。如上所示，相比于迭代器，apply暴露了更少的状态。</p>
<p>#LoD(得墨忒耳定律)<br>为了达到目标，我们决定尽可能少的暴露状态。很不错！现在我们可以在自己类的内部随意向其他对象发送命令和请求了吗？好吧，你的确可以这么做，但是根据得墨忒耳定律，这样做同样是有害的。得墨忒耳定律约束了类型间的交互来降低耦合。（更多讨论可以看这里[2])</p>
<p>得墨忒耳定律表明，你的类和越多的对象发生关联，因为某个对象修改导致你的类被破坏的概率就越大。所以，你不仅要尽可能少说话（暴露自己的状态），还要尽可能的少和其他对象发生关联。实际上，根据得墨忒耳定律关于方法的阐述，一个对象的任何方法只可以调用属于以下对象的方法：</p>
<ul>
<li>它自己</li>
<li>传入这个方法的参数</li>
<li>这个对象创建的对象</li>
<li>复合的对象</li>
</ul>
<p>显然这里没有包含其他调用返回的对象的方法。例如（这里使用Java说明）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SortedList thingy = someObject.getEmployeeList(); thingy.addElementWithKey(foo.getKey(), foo);</div></pre></td></tr></table></figure></p>
<p>这正是我们需要避免的（这里的foo.getKey()也是一个违反了Tell Don’t Ask的例子）。像这样直接访问一个子对象给调用增加了不必要的耦合。调用者依赖于如下实现：</p>
<ul>
<li>someObject将employees保存到一个SortedList中</li>
<li>SortedList的add方法是addElementWithKey()</li>
<li>foo获取key的方法是getKey()</li>
</ul>
<p>这里更好的做法是<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">someObject.addToThingy(foo);</div></pre></td></tr></table></figure><br>现在调用者只依赖于一个实现：他可以将foo添加到thingy中，作为一个任务，这听起来足够抽象，而不必过分依赖实现细节。</p>
<p>这么做的弊端也很明显，你需要写很多的包装函数来做诸如容器遍历之类的细小的工作。这里需要在低效和高耦合之间做出选择。</p>
<p>类型之间耦合越高，你的修改就越可能影响到其他的类。这会增加代码的脆弱性。</p>
<p>根据你应用的不同，在大多数情况下，高耦合代码带来的开发和维护成本的增加造成的影响远大于运行时效率的降低。</p>
<p>#分离命令和查询<br>让我们回到查询和命令的话题上来。我同意将命令和查询放到不同方法的做法。为什么呢？</p>
<ul>
<li>明确的定义良好的命令维护了“Tell, Don’t Ask”原则。</li>
<li>如果你的类是基于命令的，它有助于你考虑到类型的不变序列。（如果你的类只是抛出数据，你很可能不会考虑到不变序列）</li>
<li>如果你可以假设某个查询的结果没有任何副作用，那么你可以：<ol>
<li>在调试器中使用查询并不影响测试的过程。</li>
<li>创建内置的自动的回归测试。</li>
<li>计算类型的不变序列，和前置后置条件。</li>
</ol>
</li>
</ul>
<p>最后，这就是为什么Eiffel要求只有没有副作用的方法可以在Assertion中被调用。即使在C++和Java中，如果你想在某处代码手动的检查一个对象的状态，并且你知道这个查询不会导致其他改变，你就可以很放心的进行这个操作。</p>
<p><strong>[注释]</strong></p>
<p>[1] Sharp, A. “Smalltalk By Example” McGraw-Hill, 1997.</p>
<p>[2] Appleton, B. <a href="!--￼4--">Introducing Demeter and Its Laws</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;原文链接：&lt;a href=&quot;https://pragprog.com/articles/tell-dont-ask&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Tell, Don’t Ask&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Alec Sharp在其最近的书Smalltalk by Example[1]中指出了一个极有价值的观点：&lt;/p&gt;
&lt;p&gt;&lt;em&gt;过程化的代码获取信息并做出决定。面向对象的代码只是告诉对象去做。&lt;br&gt;— Alec Sharp&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;这意味着，你应该尝试直接告诉对象你希望他们去做什么，而不是询问他们的状态，做出决定，再告诉他们去做什么。&lt;/p&gt;
&lt;p&gt;这样做的问题是，作为调用者，你不应该根据你获得的被调用对象的状态来做决定, 然后再去改变对象的状态。你实现的这部分逻辑很可能是被调用对象的职责，而不是你的。由你来在对象外部做出决定破坏了它的封装。&lt;/p&gt;
&lt;p&gt;当然，你可以说，这是显然的。我从来不会写那样的代码。然而，我们仍然会通过检验一些引用对象，并根据不同的返回值调用不同的方法。但是这也许不是最好的做法。告诉对象你要什么，由它来决定如何做。要用声明式的思考方式，而不是过程式的！&lt;br&gt;
    
    </summary>
    
      <category term="Software Engineering" scheme="http://codethink.me/categories/Software-Engineering/"/>
    
    
      <category term="Software Engineering" scheme="http://codethink.me/tags/Software-Engineering/"/>
    
      <category term="OOP" scheme="http://codethink.me/tags/OOP/"/>
    
  </entry>
  
  <entry>
    <title>再谈MVP与MVVM</title>
    <link href="http://codethink.me/2015/08/06/mvp-and-mvvm/"/>
    <id>http://codethink.me/2015/08/06/mvp-and-mvvm/</id>
    <published>2015-08-06T10:50:42.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>#0.  前言<br>之前写过<a href="http://codethink.me/tags/MVP/">3篇博客</a>分析Philm MVP架构的实现，最近在接触到一些关于clean architecture的话题后，又仔细读了一些关于MVP以及MVVM的文章，觉得当时的一些理解不够深入，因此针对应用架构的理论部分重新做出总结。</p>
<p>#1. Model-View-Presenter<br>Martin Fowler的这篇<a href="http://martinfowler.com/eaaDev/ModelViewPresenter.html" target="_blank" rel="external">Retirement note for Model View Presenter Pattern</a>文章明确表明了，这个模式已经“退休”了。作为MVC模式的变形之一，它被重新归纳为了MVC模式的两种变形：Passive View和Supervisor controller。</p>
<p>##1.1 Passive View<br>Passive View是MVC模式的一种变形。对于UI而言，它被分为负责显示的View和接收用户交互的Controller。Passive View是一个完全被动的View，不负责UI更新，因此也不依赖Model。</p>
<p>这种模式强调的是View与Model之间的独立，Controller负责全部的View与Model的同步工作，所有的消息都需要通过Controller传递。<br><a id="more"></a></p>
<p>##1.2 Supervising Controller<br>Supervising Controller模式强调Controller只处理复杂逻辑和部分与View和Model之间的同步。Controller中尽可能减少View与Model的同步工作，将其转交数据绑定来实现，Controller只处理同步机制无法处理的复杂的交互和同步。因此，这种模式中View与Model需要直接通信，存在依赖关系。</p>
<p>#2. Model-View-ViewModel<br>ViewModel可以同时和多个Domain Model交互，它并不是一个特定Domain Model为了适合View而构建的外观模式。我们可以认为ViewModel是一个特殊的，不依赖于系统GUI框架的View。此外，需要注意的是。一个ViewModel可以应用于多个View，但是一个View只能拥有一个ViewModel。</p>
<p>所有的事件和响应逻辑都需要ViewModel来处理，因此它的View变得很简单，这与Passive View模式很相似。它与Passive View的区别在于: ViewModel中不包含控件，控件需要依靠自己获取ViewModel中的状态。而Passive View中的Controller可以包含控件，这降低了控件自己获取状态带来的风险，但是，Passive View也因此引入了新的问题：它依赖于系统GUI控件，无法独立进行测试。</p>
<p>#3.小结<br>总结一下3种模式的特点：<br>1) Passive View： 强调View与Model的独立，Controller负责全部的同步工作。<br>2) Supervising Controller：强调Controller中只处理复杂逻辑，尽可能少的负责View与Model间的同步工作。View与Model相互依赖。<br>3）MVVM：强调ViewModel作为一个View的抽象层，其与实际的View一对多的关系，同时其自身不依赖系统控件，方便独立测试。</p>
<p>#参考</p>
<ol>
<li><a href="http://martinfowler.com/eaaDev/ModelViewPresenter.html" target="_blank" rel="external">Retirement note for Model View Presenter Pattern</a></li>
<li><a href="http://martinfowler.com/eaaDev/uiArchs.html" target="_blank" rel="external">GUI Architectures</a></li>
<li><a href="http://martinfowler.com/eaaDev/PassiveScreen.html" target="_blank" rel="external">Passive View</a></li>
<li><a href="http://martinfowler.com/eaaDev/SupervisingPresenter.html" target="_blank" rel="external">Supervising Controller</a></li>
<li><a href="http://martinfowler.com/eaaDev/PresentationModel.html" target="_blank" rel="external">Presentation Model</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#0.  前言&lt;br&gt;之前写过&lt;a href=&quot;http://codethink.me/tags/MVP/&quot;&gt;3篇博客&lt;/a&gt;分析Philm MVP架构的实现，最近在接触到一些关于clean architecture的话题后，又仔细读了一些关于MVP以及MVVM的文章，觉得当时的一些理解不够深入，因此针对应用架构的理论部分重新做出总结。&lt;/p&gt;
&lt;p&gt;#1. Model-View-Presenter&lt;br&gt;Martin Fowler的这篇&lt;a href=&quot;http://martinfowler.com/eaaDev/ModelViewPresenter.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Retirement note for Model View Presenter Pattern&lt;/a&gt;文章明确表明了，这个模式已经“退休”了。作为MVC模式的变形之一，它被重新归纳为了MVC模式的两种变形：Passive View和Supervisor controller。&lt;/p&gt;
&lt;p&gt;##1.1 Passive View&lt;br&gt;Passive View是MVC模式的一种变形。对于UI而言，它被分为负责显示的View和接收用户交互的Controller。Passive View是一个完全被动的View，不负责UI更新，因此也不依赖Model。&lt;/p&gt;
&lt;p&gt;这种模式强调的是View与Model之间的独立，Controller负责全部的View与Model的同步工作，所有的消息都需要通过Controller传递。&lt;br&gt;
    
    </summary>
    
      <category term="Software Engineering" scheme="http://codethink.me/categories/Software-Engineering/"/>
    
    
      <category term="MVP" scheme="http://codethink.me/tags/MVP/"/>
    
      <category term="MVVM" scheme="http://codethink.me/tags/MVVM/"/>
    
      <category term="Passive View" scheme="http://codethink.me/tags/Passive-View/"/>
    
      <category term="Supervising Controller" scheme="http://codethink.me/tags/Supervising-Controller/"/>
    
  </entry>
  
  <entry>
    <title>使用Dagger 2进行依赖注入</title>
    <link href="http://codethink.me/2015/08/06/dependency-injection-with-dagger-2/"/>
    <id>http://codethink.me/2015/08/06/dependency-injection-with-dagger-2/</id>
    <published>2015-08-06T00:33:16.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>#0. 前言<br>Dagger2是首个使用生成代码实现完整依赖注入的框架，极大减少了使用者的编码负担，<br>本文主要介绍如何使用Dagger2进行依赖注入。如果你不还不了解依赖注入，请看<a href="http://codethink.me/2015/08/01/dependency-injection-theory/">这一篇</a>。</p>
<p>#1. 简单的依赖注入<br>首先我们构建一个简单Android应用。我们创建一个UserModel，然后将它显示到TextView中。这里的问题是，在创建UserModel的时候，我们使用了<a href="http://codethink.me/2015/08/01/dependency-injection-theory/">前文</a>所说的hard init。一旦我们的UserModel的创建方式发生了改变（比如需要传入Context对象到构造函数），我们就需要修改所有创建UserModel的代码。而我们希望的是，对于UserModel的修改不影响其他模块的代码（比如这里的MainActivity）。<br><a id="more"></a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        UserModel user = <span class="keyword">new</span> UserModel();</div><div class="line">        ((TextView) findViewById(R.id.user_desc_line)).setText(user.id + <span class="string">"\n"</span> + user.name + <span class="string">"\n"</span> + user.gender);</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure></p>
<p>##1.1 构建依赖<br>我们首先想到的是，将创建UserModel的代码独立出来，这样可以保证MainActivity的代码不被修改。Dagger2中，这个负责提供依赖的组件被称为Module。我们构建的ActivityModule代码如下所示。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActivityModule</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span> <span class="function">UserModel <span class="title">provideUserModel</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserModel();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>可以看到，我们使用@Module标识类型为module，并用@Provides标识提供依赖的方法。</p>
<p>##1.2 构建Injector<br>有了提供依赖的组件，我们还需要将依赖注入到需要的对象中。连接提供依赖和消费依赖对象的组件被称为Injector。Dagger2中，我们将其称为component。ActivityComponent代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span>(modules = ActivityModule.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ActivityComponent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity activity)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>可以看到，Component是一个使用@Component标识的Java interface。interface的inject方法需要一个消耗依赖的类型对象作为参数。<br><strong>注意：这里必须是真正消耗依赖的类型MainActivity，而不可以写成其父类，比如Activity。因为Dagger2在编译时生成依赖注入的代码，会到inject方法的参数类型中寻找可以注入的对象，但是实际上这些对象存在于MainActivity，而不是Activity中。如果函数声明参数为Activity，Dagger2会认为没有需要注入的对象。当真正在MainActivity中创建Component实例进行注入时，会直接执行按照Activity作为参数生成的inject方法，导致所有注入都失败。(是的，我是掉进这个坑了。)</strong></p>
<p>##1.3 完成依赖注入<br>最后，我们需要在MainActivity中构建Injector对象，完成注入。这部分代码如下所示。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> ActivityComponent mActivityComponent;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span> UserModel userModel;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        mActivityComponent = DaggerActivityComponent.builder().activityModule(<span class="keyword">new</span> ActivityModule()).build();</div><div class="line">        mActivityComponent.inject(<span class="keyword">this</span>);</div><div class="line">        ((TextView) findViewById(R.id.user_desc_line)).setText(userModel.id + <span class="string">"\n"</span> + userModel.name + <span class="string">"\n"</span> + userModel.gender);</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>首先，我们使用@Inject标志被注入的对象userModel（注意userModel不能为private），之后通过Dagger2生成的实现了我们提供的ActivityComponent接口类DaggerActivityComponent创建component，调用其inject方法完成注入。</p>
<p>至此，我们使用Dagger实现了最简单的依赖注入。</p>
<p>#2. 多层依赖<br>除了上面这种最简单的形式，Dagger2还可以使用component作为component的依赖，实现多层级的依赖注入。</p>
<p>##2.1 构建依赖<br>我们新创建一个名为ShoppingCartModel的Domain Model。并按照1.1的方法构建其Module如下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContainerModule</span> </span>&#123;</div><div class="line">    <span class="meta">@Provides</span> <span class="function">ShoppingCartModel <span class="title">provideCartModel</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShoppingCartModel();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##2.2 构建Injector<br>与1.2不同的是，我们的Injector提供的依赖不仅来自ContainerModule，我们还需要使用之前的ActivityComponent提供的UserModel依赖。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span>(dependencies = ActivityComponent.class, modules = ContainerModule.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ContainerComponent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity mainActivity)</span></span>;</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure></p>
<p>所以如代码所示，我们在component后增加ActivityComponent了dependencies参数，使得一个Component成为了另一个Component的依赖。</p>
<p>##2.3 低级Component提供依赖<br>目前的ActivityComponent代码如下所示。可以看到其只提供了inject方法，而没有提供需要的UserModel依赖。我们需要的是将ActivityModule提供的UserModel传递给依赖ActivityComponent的ContainerComponent。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span>(modules = ActivityModule.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ActivityComponent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity activity)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>修改后代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span>(modules = ActivityModule.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ActivityComponent</span> </span>&#123;</div><div class="line"><span class="comment">//    void inject(MainActivity activity);</span></div><div class="line">    <span class="function">UserModel <span class="title">userModel</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>可以看到，我们为接口增加了提供UserModel依赖的方法，同时，如果不需要使它直接进行注入，可以去掉其inject方法，此时该Component只作为一种依赖的组织模块。</p>
<p>最后，MainActivity中进行依赖注入的代码如下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> ActivityComponent mActivityComponent;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    UserModel userModel;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    ShoppingCartModel cartModel;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        mActivityComponent = DaggerActivityComponent.builder().activityModule(<span class="keyword">new</span> ActivityModule()).build();</div><div class="line">        ContainerComponent containerComponent = DaggerContainerComponent.builder().activityComponent(mActivityComponent).containerModule(<span class="keyword">new</span> ContainerModule()).build();</div><div class="line"></div><div class="line">        containerComponent.inject(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">        ((TextView) findViewById(R.id.user_desc_line)).setText(userModel.id + <span class="string">"\n"</span> + userModel.name + <span class="string">"\n"</span> + userModel.gender + <span class="string">"\n"</span> + cartModel.total);</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#3. 最后</p>
<p>本文试图用最简单的例子介绍Android中如何使用Dagger2进行依赖注入，因此有很多Dagger2的特性并未涉及，比如@Scope注释，以及Dagger2自动生成代码的分析调试。关于Dagger2更深入的特性的分析，还需要在大量使用后再做出总结。</p>
<p>#参考</p>
<ol>
<li><a href="http://google.github.io/dagger/" target="_blank" rel="external">Dagger 2</a></li>
<li><a href="http://fernandocejas.com/2015/04/11/tasting-dagger-2-on-android/" target="_blank" rel="external">Tasting Dagger 2 on Android</a></li>
<li><a href="http://frogermcs.github.io/dependency-injection-with-dagger-2-the-api/" target="_blank" rel="external">Dependency injection with Dagger 2 - the API</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#0. 前言&lt;br&gt;Dagger2是首个使用生成代码实现完整依赖注入的框架，极大减少了使用者的编码负担，&lt;br&gt;本文主要介绍如何使用Dagger2进行依赖注入。如果你不还不了解依赖注入，请看&lt;a href=&quot;http://codethink.me/2015/08/01/dependency-injection-theory/&quot;&gt;这一篇&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;#1. 简单的依赖注入&lt;br&gt;首先我们构建一个简单Android应用。我们创建一个UserModel，然后将它显示到TextView中。这里的问题是，在创建UserModel的时候，我们使用了&lt;a href=&quot;http://codethink.me/2015/08/01/dependency-injection-theory/&quot;&gt;前文&lt;/a&gt;所说的hard init。一旦我们的UserModel的创建方式发生了改变（比如需要传入Context对象到构造函数），我们就需要修改所有创建UserModel的代码。而我们希望的是，对于UserModel的修改不影响其他模块的代码（比如这里的MainActivity）。&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://codethink.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://codethink.me/tags/Android/"/>
    
      <category term="Dependency Injection" scheme="http://codethink.me/tags/Dependency-Injection/"/>
    
      <category term="Software Engineering" scheme="http://codethink.me/tags/Software-Engineering/"/>
    
  </entry>
  
  <entry>
    <title>依赖注入原理</title>
    <link href="http://codethink.me/2015/08/01/dependency-injection-theory/"/>
    <id>http://codethink.me/2015/08/01/dependency-injection-theory/</id>
    <published>2015-08-01T04:03:56.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>#0. 前言<br>在软件工程领域，依赖注入（Dependency Injection）是用于实现控制反转（Inversion of Control）的最常见的方式之一。本文主要介绍依赖注入原理和常见的实现方式，重点在于介绍这种年轻的设计模式的适用场景及优势。</p>
<p>#1. 为什么需要依赖注入<br>控制反转用于解耦，解的究竟是谁和谁的耦？这是我在最初了解依赖注入时候产生的第一个问题。</p>
<p>下面我引用Martin Flower在解释介绍注入时使用的一部分代码来说明这个问题。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieLister</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> MovieFinder finder;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MovieLister</span><span class="params">()</span> </span>&#123;</div><div class="line">        finder = <span class="keyword">new</span> MovieFinderImpl();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> Movie[] moviesDirectedBy(String arg) &#123;</div><div class="line">        List allMovies = finder.findAll();</div><div class="line">        <span class="keyword">for</span> (Iterator it = allMovies.iterator(); it.hasNext();) &#123;</div><div class="line">            Movie movie = (Movie) it.next();</div><div class="line">            <span class="keyword">if</span> (!movie.getDirector().equals(arg)) it.remove();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> (Movie[]) allMovies.toArray(<span class="keyword">new</span> Movie[allMovies.size()]);</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MovieFinder</span> </span>&#123;</div><div class="line">    <span class="function">List <span class="title">findAll</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>我们创建了一个名为MovieLister的类来提供需要的电影列表，它moviesDirectedBy方法提供根据导演名来搜索电影的方式。真正负责搜索电影的是实现了MovieFinder接口的MovieFinderImpl，我们的MovieLister类在构造函数中创建了一个MovieFinderImpl的对象。</p>
<p>目前看来，一切都不错。但是，当我们希望修改finder，将finder替换为一种新的实现时（比如为MovieFinder增加一个参数表明Movie数据的来源是哪个数据库），我们不仅需要修改MovieFinderImpl类，还需要修改我们MovieLister中创建MovieFinderImpl的代码。</p>
<p><strong>这就是依赖注入要处理的耦合。这种在MovieLister中创建MovieFinderImpl的方式，使得MovieLister不仅仅依赖于MovieFinder这个接口，它还依赖于MovieListImpl这个实现。</strong> 这种在一个类中直接创建另一个类的对象的代码，和硬编码（hard-coded strings)以及硬编码的数字（magic numbers）一样，是一种导致耦合的坏味道，我们可以把这种坏味道称为硬初始化（hard init）。同时，我们也应该像记住硬编码一样记住，new（对象创建）是有毒的。</p>
<p>Hard Init带来的主要坏处有两个方面：1）上文所述的修改其实现时，需要修改创建处的代码；2）不便于测试，这种方式创建的类（上文中的MovieLister）无法单独被测试，其行为和MovieFinderImpl紧紧耦合在一起，同时，也会导致代码的可读性问题（“如果一段代码不便于测试，那么它一定不便于阅读。”）。</p>
<p>#2. 依赖注入的实现方式<br>依赖注入其实并不神奇，我们日常的代码中很多都用到了依赖注入，但很少注意到它，也很少主动使用依赖注入进行解耦。这里我们简单介绍一下赖注入实现三种的方式。</p>
<p>##2.1 构造函数注入（Contructor Injection）<br>这是我认为的最简单的依赖注入方式，我们修改一下上面代码中MovieList的构造函数，使得MovieFinderImpl的实现在MovieLister类之外创建。这样，MovieLister就只依赖于我们定义的MovieFinder接口，而不依赖于MovieFinder的实现了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieLister</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> MovieFinder finder;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MovieLister</span><span class="params">(MovieFinder finder)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.finder = finder;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##2.2 setter注入<br>类似的，我们可以增加一个setter函数来传入创建好的MovieFinder对象，这样同样可以避免在MovieFinder中hard init这个对象。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieLister</span> </span>&#123;</div><div class="line">    s...</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFinder</span><span class="params">(MovieFinder finder)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.finder = finder;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##2.3 接口注入<br>接口注入使用接口来提供setter方法，其实现方式如下。<br>首先要创建一个注入使用的接口。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InjectFinder</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">injectFinder</span><span class="params">(MovieFinder finder)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>之后，我们让MovieLister实现这个接口。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieLister</span> <span class="keyword">implements</span> <span class="title">InjectFinder</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">injectFinder</span><span class="params">(MovieFinder finder)</span> </span>&#123;</div><div class="line">      <span class="keyword">this</span>.finder = finder;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>最后，我们需要根据不同的框架创建被依赖的MovieFinder的实现。</p>
<p>#3. 最后<br>依赖注入降低了依赖和被依赖类型间的耦合，在修改被依赖的类型实现时，不需要修改依赖类型的实现，同时，对于依赖类型的测试，可以更方便的使用mocking object替代原有的被依赖类型，以达到对依赖对象独立进行单元测试的目的。</p>
<p>最后需要注意的是，依赖注入只是控制反转的一种实现方式。控制反转还有一种常见的实现方式称为依赖查找。</p>
<p>#参考</p>
<ol>
<li><a href="http://martinfowler.com/articles/injection.html" target="_blank" rel="external">Inversion of Control Containers and the Dependency Injection pattern</a></li>
<li><a href="http://googletesting.blogspot.jp/2008/07/how-to-think-about-new-operator-with.html" target="_blank" rel="external">How to Think About the “new” Operator with Respect to Unit Testing</a></li>
<li><a href="https://github.com/android-cn/blog/tree/master/java/dependency-injection" target="_blank" rel="external">依赖注入</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#0. 前言&lt;br&gt;在软件工程领域，依赖注入（Dependency Injection）是用于实现控制反转（Inversion of Control）的最常见的方式之一。本文主要介绍依赖注入原理和常见的实现方式，重点在于介绍这种年轻的设计模式的适用场景及优势。&lt;/p&gt;
&lt;p&gt;#1. 为什么需要依赖注入&lt;br&gt;控制反转用于解耦，解的究竟是谁和谁的耦？这是我在最初了解依赖注入时候产生的第一个问题。&lt;/p&gt;
&lt;p&gt;下面我引用Martin Flower在解释介绍注入时使用的一部分代码来说明这个问题。&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MovieLister&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; MovieFinder finder;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MovieLister&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        finder = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MovieFinderImpl();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Movie[] moviesDirectedBy(String arg) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        List allMovies = finder.findAll();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (Iterator it = allMovies.iterator(); it.hasNext();) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            Movie movie = (Movie) it.next();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!movie.getDirector().equals(arg)) it.remove();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (Movie[]) allMovies.toArray(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Movie[allMovies.size()]);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MovieFinder&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;List &lt;span class=&quot;title&quot;&gt;findAll&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Software Engineering" scheme="http://codethink.me/categories/Software-Engineering/"/>
    
    
      <category term="Dependency Injection" scheme="http://codethink.me/tags/Dependency-Injection/"/>
    
      <category term="Inversion of Control" scheme="http://codethink.me/tags/Inversion-of-Control/"/>
    
      <category term="Software Engineering" scheme="http://codethink.me/tags/Software-Engineering/"/>
    
  </entry>
  
  <entry>
    <title>一种新的Activity转换动画实现方式</title>
    <link href="http://codethink.me/2015/06/21/a-new-implementation-of-activity-transition-animations/"/>
    <id>http://codethink.me/2015/06/21/a-new-implementation-of-activity-transition-animations/</id>
    <published>2015-06-21T07:27:19.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>#0. 前言<br>为Android中基本的View组建Activity设置转换动画的方式一般有两种：通过overridePendingTransitions设置，以及使用TransitionManager实现。overridePendingTransitions只能使用XML来设置Activity的进入和退出动画，局限性很大。而使用TransitionManager只兼容API level 19及以上的设备。最近在<a href="http://frogermcs.github.io/Instagram-with-Material-Design-concept-part-2-Comments-transition/" target="_blank" rel="external">InstaMaterial concept</a>中发现其利用addOnPreDrawListener方法，提供了一种新的Activity转换动画实现方式，这里详细记录下这种基于addOnPreDrawListener()的实现方式。</p>
<p>#1. 实现展开动画<br>首先创建一个基本的Activity转换场景，去掉默认的转换动画，没有任何动画的Activity转换效果如下。<br><a id="more"></a><br><img src="/images/transition-no-anim.gif" alt=""><br>修改第二个Activity的布局activty_second，设置最顶层的布局id为root。之后，在SecondAcivity的onCreate中，为root设置动画，核心部分代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">    setContentView(R.layout.activity_second);</div><div class="line"></div><div class="line">    rootView = findViewById(R.id.root);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (savedInstanceState == <span class="keyword">null</span>) &#123;</div><div class="line">        rootView.getViewTreeObserver().addOnPreDrawListener(<span class="keyword">new</span> ViewTreeObserver.OnPreDrawListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPreDraw</span><span class="params">()</span> </span>&#123;</div><div class="line">                rootView.getViewTreeObserver().removeOnPreDrawListener(<span class="keyword">this</span>);</div><div class="line">                startRootAnimation();</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>这里需要注意的是： 1)只需要在首次创建时执行动画，因此需要满足条件savedInstanceState == null；2）在onPreDraw中要首先移除OnPreDrawListener，否则在动画过程中会多次调用，导致死循环。<br>最后，startRootAnimation的实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startRootAnimation</span><span class="params">()</span> </span>&#123;</div><div class="line">    rootView.setScaleY(<span class="number">0.1f</span>);</div><div class="line">    rootView.setPivotY(rootView.getY() + rootView.getHeight() / <span class="number">2</span>);</div><div class="line"></div><div class="line">    rootView.animate()</div><div class="line">            .scaleY(<span class="number">1</span>)</div><div class="line">            .setDuration(<span class="number">1000</span>)</div><div class="line">            .setInterpolator(<span class="keyword">new</span> AccelerateInterpolator())</div><div class="line">            .start();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>此时的动画效果如下：<br><img src="/images/transition-basic-anim.gif" alt=""></p>
<p>#2. 设置Activity透明背景<br>上面的动画还有一个问题：第二个Activity展开的时候，它的背景不是第一个Activity，而是白色背景，这是因为默认的主题为每个Activity设置了白色作为窗口的背景，因此需要在style中创建一个背景为透明的主题，并在AndroidManifest.xml中设置SecondActivty的主题为透明背景主题。<br>透明背景主题代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme.TransparentActivity"</span>&gt;</span><span class="xml"></span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@android:color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowIsTranslucent"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowAnimationStyle"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure><br>最后的效果如下：<br><img src="/images/transition-anim.gif" alt=""></p>
<p>#3. 小结<br>至此实现了一个简单的基于addOnPreDrawListener的转换动画，这种转换动画相对于overridePendingTransitions更为灵活，提供了更多想象空间，同时相比于TransitionManager有更好的兼容性。</p>
<p>这种方式目前存在的问题是需要为顶级view以及各层子view分别设置动画，使得顶级view和子view同时展开，或子view延后展开（否则会出现子view已经绘制到目标位置，顶级view仍然在执行动画的情况），对于复杂的布局而言实现有些繁琐。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#0. 前言&lt;br&gt;为Android中基本的View组建Activity设置转换动画的方式一般有两种：通过overridePendingTransitions设置，以及使用TransitionManager实现。overridePendingTransitions只能使用XML来设置Activity的进入和退出动画，局限性很大。而使用TransitionManager只兼容API level 19及以上的设备。最近在&lt;a href=&quot;http://frogermcs.github.io/Instagram-with-Material-Design-concept-part-2-Comments-transition/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;InstaMaterial concept&lt;/a&gt;中发现其利用addOnPreDrawListener方法，提供了一种新的Activity转换动画实现方式，这里详细记录下这种基于addOnPreDrawListener()的实现方式。&lt;/p&gt;
&lt;p&gt;#1. 实现展开动画&lt;br&gt;首先创建一个基本的Activity转换场景，去掉默认的转换动画，没有任何动画的Activity转换效果如下。&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://codethink.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://codethink.me/tags/Android/"/>
    
      <category term="Transition" scheme="http://codethink.me/tags/Transition/"/>
    
      <category term="Animations" scheme="http://codethink.me/tags/Animations/"/>
    
  </entry>
  
  <entry>
    <title>在Android Studio中使用Roboletric和Espresso</title>
    <link href="http://codethink.me/2015/05/27/use-robolectric-with-espresso-in-android-studio/"/>
    <id>http://codethink.me/2015/05/27/use-robolectric-with-espresso-in-android-studio/</id>
    <published>2015-05-27T10:38:33.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>#0. 前言<br>在Android开发中，测试是一个很少被提及的话题。在早期，Android并没有一个很好的测试框架，你也很难找到一个测试全面的优秀开源项目。近些年，随着Android社区的成熟，出现了诸如Robotium，Robolectric等的优秀测试框架。而Google也在近期推出了自己的UI测试框架Espresso。</p>
<p>本文基于最简单的Hello World项目进行测试，重点在于介绍Robolectric和Espresso的配置.。项目完整的示例代码在<a href="https://github.com/archieyang/EspressoAndRobolectricTestDemo" target="_blank" rel="external">这里</a>。</p>
<p>#1. 使用Espresso进行Instrumentaion Test<br>首先创建一个最简单的Android项目，包含一个Hello World的TextView。打开Build Variant，选择Android Instumentation Tests。在build.gradle中配置Espresso，增加的代码如下：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    ...</div><div class="line">    defaultConfig &#123;</div><div class="line">        ...</div><div class="line">        testInstrumentationRunner <span class="string">"android.support.test.runner.AndroidJUnitRunner"</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    packagingOptions &#123;</div><div class="line">        exclude <span class="string">'LICENSE.txt'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    ...</div><div class="line">    androidTestCompile <span class="string">'com.android.support.test.espresso:espresso-core:2.1'</span></div><div class="line">    androidTestCompile <span class="string">'com.android.support.test:runner:0.2'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><br>之后点击Gradle同步。</p>
<p>到src/androidTest删除自动生成的ApplicationTest.java，新建MainActivityTest.java如下。这段代码主要是测试Hello world!这段文字是否显示到了界面上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@LargeTest</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivityTest</span> <span class="keyword">extends</span> <span class="title">ActivityInstrumentationTestCase2</span>&lt;<span class="title">MainActivity</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainActivityTest</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(MainActivity.class);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">super</span>.setUp();</div><div class="line">        getActivity();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHelloWorldOnView</span><span class="params">()</span> </span>&#123;</div><div class="line">        onView(withText(<span class="string">"Hello world!"</span>)).check(matches(isDisplayed()));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>右击MainActivityTest.java，选择Run，如下图所示。<br><img src="/images/run-espresso.png" alt=""><br>选择运行的设备之后可以到在下方控制台看到打印的测试成功信息如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">Testing started at 下午<span class="number">7</span>:<span class="number">08</span> ...</div><div class="line">Installing me.codethink.testdemo</div><div class="line">DEVICE SHELL COMMAND: pm install -r <span class="string">"/data/local/tmp/me.codethink.testdemo"</span></div><div class="line">pkg: /data/local/tmp/me.codethink.testdemo</div><div class="line">Success</div><div class="line"></div><div class="line"></div><div class="line">Uploading file</div><div class="line">	local path: /Users/archie/AndroidStudioProjects/TestDemo/app/build/outputs/apk/app-debug-androidTest-unaligned.apk</div><div class="line">	remote path: /data/local/tmp/me.codethink.testdemo.test</div><div class="line">Installing me.codethink.testdemo.test</div><div class="line">DEVICE SHELL COMMAND: pm install -r <span class="string">"/data/local/tmp/me.codethink.testdemo.test"</span></div><div class="line">pkg: /data/local/tmp/me.codethink.testdemo.test</div><div class="line">Success</div><div class="line"></div><div class="line"></div><div class="line">Running tests</div><div class="line">Test running startedFinish</div></pre></td></tr></table></figure><br>此时到Run -&gt; Edit Configurations查看，可以看到增加了MainActivityTest，如下图所示。<br><img src="/images/run-espresso-config.png" alt=""><br>至此完成了一个简单的Espresso测试。</p>
<p>#2. 使用Robolectric进行Test<br>首先复制androidTest文件夹到同一个目录下，重命名为test。打开Build Variant，选择Unit Tests。<br><img src="/images/android-studio-build-variants.png" alt=""><br>修改build.gradle，增加Robolectric依赖如下。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    ...</div><div class="line">    dependencies &#123;</div><div class="line">        ...</div><div class="line">        testCompile <span class="string">'junit:junit:4.12'</span></div><div class="line">        testCompile <span class="string">"org.assertj:assertj-core:1.7.0"</span></div><div class="line">        testCompile(<span class="string">'org.robolectric:robolectric:3.0-rc2'</span>) &#123;</div><div class="line">            exclude <span class="string">group:</span> <span class="string">'commons-logging'</span>, <span class="string">module:</span> <span class="string">'commons-logging'</span></div><div class="line">            exclude <span class="string">group:</span> <span class="string">'org.apache.httpcomponents'</span>, <span class="string">module:</span> <span class="string">'httpclient'</span></div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>删除test目录下的MainActivityTest.java，新建MainActivityUnitTest.java代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(RobolectricGradleTestRunner.class)</div><div class="line"><span class="meta">@Config</span>(constants = BuildConfig.class, emulateSdk = <span class="number">21</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivityUnitTest</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> MainActivity activity;</div><div class="line"></div><div class="line">    <span class="meta">@Before</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        activity = Robolectric.setupActivity(MainActivity.class);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHelloWorld</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        TextView helloWorldTextView = (TextView) activity.findViewById(R.id.textview_id);</div><div class="line">        assertThat(helloWorldTextView.getText().toString()).isEqualTo(<span class="string">"Hello World!"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><br>右键点击test目录下的MainActivityUnitTest.java，选择Run。<br><img src="/images/run-robolectric.png" alt=""><br>之后可以在控制台看到测试成功的信息。<br>此时到Run -&gt; Edit Configurations查看，可以看到增加了MainActivityUnitTest，如下图所示。<br><img src="/images/run-robolectric-config.png" alt=""><br>把assertThat(helloWorldTextView.getText().toString()).isEqualTo(“Hello world!”)中的world改为World，再次Run改测试，可以在控制台看到错误信息以及生成的错误报告的地址，错报告内容如下图所示：<br><img src="/images/robolectric-test-report.png" alt=""></p>
<p>#3. 小结<br>Espresso作为Google推出的Instrumentation UI测试框架，在API支持方面有着天然的优势，在推出后很大程度上替代了Robotium。而Robolectric由于只在Java虚拟机中运行，速度很快，虽然在API支持上无法和Espresso相比，但速度有很大优势，适合单元测试，尤其是TDD时使用。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#0. 前言&lt;br&gt;在Android开发中，测试是一个很少被提及的话题。在早期，Android并没有一个很好的测试框架，你也很难找到一个测试全面的优秀开源项目。近些年，随着Android社区的成熟，出现了诸如Robotium，Robolectric等的优秀测试框架。而Google也在近期推出了自己的UI测试框架Espresso。&lt;/p&gt;
&lt;p&gt;本文基于最简单的Hello World项目进行测试，重点在于介绍Robolectric和Espresso的配置.。项目完整的示例代码在&lt;a href=&quot;https://github.com/archieyang/EspressoAndRobolectricTestDemo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;#1. 使用Espresso进行Instrumentaion Test&lt;br&gt;首先创建一个最简单的Android项目，包含一个Hello World的TextView。打开Build Variant，选择Android Instumentation Tests。在build.gradle中配置Espresso，增加的代码如下：&lt;br&gt;&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;apply &lt;span class=&quot;string&quot;&gt;plugin:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;com.android.application&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;android &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    defaultConfig &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        ...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        testInstrumentationRunner &lt;span class=&quot;string&quot;&gt;&quot;android.support.test.runner.AndroidJUnitRunner&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    packagingOptions &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        exclude &lt;span class=&quot;string&quot;&gt;&#39;LICENSE.txt&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;dependencies &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    androidTestCompile &lt;span class=&quot;string&quot;&gt;&#39;com.android.support.test.espresso:espresso-core:2.1&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    androidTestCompile &lt;span class=&quot;string&quot;&gt;&#39;com.android.support.test:runner:0.2&#39;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;br&gt;之后点击Gradle同步。&lt;/p&gt;
&lt;p&gt;到src/androidTest删除自动生成的ApplicationTest.java，新建MainActivityTest.java如下。这段代码主要是测试Hello world!这段文字是否显示到了界面上。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@LargeTest&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MainActivityTest&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ActivityInstrumentationTestCase2&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;MainActivity&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MainActivityTest&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(MainActivity.class);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setUp&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.setUp();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        getActivity();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;testHelloWorldOnView&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        onView(withText(&lt;span class=&quot;string&quot;&gt;&quot;Hello world!&quot;&lt;/span&gt;)).check(matches(isDisplayed()));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Android" scheme="http://codethink.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://codethink.me/tags/Android/"/>
    
      <category term="Test" scheme="http://codethink.me/tags/Test/"/>
    
      <category term="Robolectric" scheme="http://codethink.me/tags/Robolectric/"/>
    
      <category term="Espresso" scheme="http://codethink.me/tags/Espresso/"/>
    
      <category term="Android Studio" scheme="http://codethink.me/tags/Android-Studio/"/>
    
  </entry>
  
  <entry>
    <title>iOS开发中3种UI跳变的处理</title>
    <link href="http://codethink.me/2015/05/19/fix-ios-jumps/"/>
    <id>http://codethink.me/2015/05/19/fix-ios-jumps/</id>
    <published>2015-05-19T11:02:08.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近在使用豆瓣api仿写一个豆瓣同城的app，过程中遇到了3中界面的跳变，解决方式整理如下。</p>
<p>#1. UIPageViewController的内容跳变<br>这里现象如图所示。<br><img src="/images/pvc-jump.gif" alt=""><br>造成这种跳变的原因主要在于，作为UIPageViewController内容的Controller，其View的边界被设置为了父View的margin。如图所示。<br><img src="/images/relative-to-margin.png" alt=""><br><a id="more"></a><br>滚动完成后，margin消失，内容View宽度扩展到没有margin的宽度，导致界面跳动。修复方法如下图所示，只需要在内容Controller中将leading和trailing设置为父View的leading和trailing，不包含margin即可。<br><img src="/images/without-margin.png" alt=""></p>
<p>修复后效果如图所示。<br><img src="/images/pvc-fixed.gif" alt=""></p>
<p>#2.UITableViewController的Top Bars跳变<br>在实现一个简单的点击UITableViewController item展示详情的界面时，在top bar出出现了如下图的跳变，容易看出是由于被top bar覆盖区域从有内容，到没有内容导致其跳动。</p>
<p><img src="/images/tableview-under-top-bars.gif" alt=""></p>
<p>这时UITableViewController关键属性设置如下：</p>
<p><img src="/images/under-top-bars.png" alt=""></p>
<p>而此时详情ViewController并没有勾选Under Top Bars这个选项。这里的Under Top Bars表示视图的上边界是否被Top Bars遮挡，出现UI跳变是因为UITableViewController的View绘制了Top Bars的背景，而详情页面没有。而由于勾选了Ajust Scroll View Insets，其内容会适应边界，不被Top Bars遮挡，视觉上和没有勾选Under Top Bars一样，下图是只勾选Under Top Bars，而不选择Ajust Scroll View Insets的界面，可以清楚的看到UITableView实际上已经上移到了Top Bars下方。<br><img src="/images/real-under-top-bars.png" alt=""></p>
<p>取消UITableViewController的这个选项后，跳变修复，效果如下图所示。</p>
<p><img src="/images/tableview-under-top-bars-fixed.gif" alt=""></p>
<p>#3.Hide Bottom Bar on Push<br>在从精选页面进入详情页面时，希望隐藏底部的Tab Bar，因此勾选了详情Controller的Hide Bottom Bar on Push选项。此时，进入详情界面时，底部出现黑色从有到无的跳变，效果如下图。<br><img src="/images/bottom-bar-jump.gif" alt=""><br>此时的详情View底部约束如下：<br><img src="/images/bottom-top.png" alt=""><br>可以看出，详情View（这里是ScrollView）的底部是于Bottom Layout Guide的顶部对齐的，而在push过程中，由于隐藏了bottom bar，Bottom Layout Guide的顶部高度发生了变化（从bottom bar上方变为屏幕底部），因此详情View高度随之变化。</p>
<p>这里的修复方式是让详情View的底部始终与Bottom Layout Guide的底部对齐，如下图所示。<br><img src="/images/bottom-bottom.png" alt=""><br>这样详情View的底部在任何时候都会绘制原来被bottom bar占有的区域，修复后效果如下图所示。<br><img src="/images/bottom-bar-fixed.gif" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近在使用豆瓣api仿写一个豆瓣同城的app，过程中遇到了3中界面的跳变，解决方式整理如下。&lt;/p&gt;
&lt;p&gt;#1. UIPageViewController的内容跳变&lt;br&gt;这里现象如图所示。&lt;br&gt;&lt;img src=&quot;/images/pvc-jump.gif&quot; alt=&quot;&quot;&gt;&lt;br&gt;造成这种跳变的原因主要在于，作为UIPageViewController内容的Controller，其View的边界被设置为了父View的margin。如图所示。&lt;br&gt;&lt;img src=&quot;/images/relative-to-margin.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://codethink.me/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://codethink.me/tags/iOS/"/>
    
      <category term="UI" scheme="http://codethink.me/tags/UI/"/>
    
  </entry>
  
  <entry>
    <title>RxJava初探</title>
    <link href="http://codethink.me/2015/05/09/intro-of-rxjava/"/>
    <id>http://codethink.me/2015/05/09/intro-of-rxjava/</id>
    <published>2015-05-09T00:19:28.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>#0.前言<br>本文主要记录了初步学习RxJava后的总结，希望用最短的篇幅讲清楚RxJava的主要用法。部分内容来自Dan Lew的<a href="http://blog.danlew.net/2014/09/15/grokking-rxjava-part-1/" target="_blank" rel="external">Grokking RxJava</a>。</p>
<p>本文的示例代码在<a href="https://github.com/archieyang/RxJavaDemo" target="_blank" rel="external">这里</a>。</p>
<p>#1 基本概念</p>
<p>##1.1 Rx结构<br>响应式编程的主要组成部分是observable, operator和susbscriber（与Dan Lew的文章不同，这里把Operator也做为组成部分介绍，这样对结构的整体性会有更全面的认识）。<br>一般响应式编程的信息流如下所示：</p>
<p>Observable -&gt; Operator 1 -&gt; Operator 2 -&gt; Operator 3 -&gt; Subscriber</p>
<p>也就是说，observable是事件的生产者，subscriber是事件最终的消费者。</p>
<p><strong>因为subscriber通常在主线程中执行，因此设计上要求其代码尽可能简单，只对事件进行响应，而修改事件的工作全部由operator执行。</strong></p>
<p>##1.2 最简单的模式<br>如果我们不需要修改事件，就不需要在observable和subscriber中插入operator。这时的Rx结构如下：</p>
<p>Obsevable -&gt; Subscriber</p>
<p>这看起来很像设计模式中的观察者模式，他们最重要的区别之一在于在没有subscriber之前，observable不会产生事件。</p>
<p>一个简单的RxJava HelloWorld的代码如下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建observable</span></div><div class="line">Observable&lt;String&gt; observable = Observable.create(<span class="keyword">new</span> Observable.OnSubscribe&lt;String&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Subscriber&lt;? <span class="keyword">super</span> String&gt; subscriber)</span> </span>&#123;</div><div class="line">        subscriber.onNext(<span class="string">"Hello RxJava"</span>);</div><div class="line">        subscriber.onCompleted();</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 创建subscriber</span></div><div class="line">Subscriber&lt;String&gt; subscriber = <span class="keyword">new</span> Subscriber&lt;String&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">        log(s);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 订阅</span></div><div class="line">observable.subscribe(subscriber);</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>这里的代码对于一句简单的HelloWorld的而言太繁琐了。因此，RxJava提供了一些简化的方法。</p>
<p>首先是创建observable，如果我们只需要发送一个事件（这里的事件是字符串”Hellow RxJava”），我们可以使用Observable类的just方法，简化后的代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建observable</span></div><div class="line">Observable&lt;String&gt; observable = Observable.just(<span class="string">"Hello RxJava"</span>);</div></pre></td></tr></table></figure>
<p>同样，如果我们不关心subscriber是否结束（onComplete())或者发生错误(onError()),subscriber的代码可以简化为</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建subscriber</span></div><div class="line">Action1&lt;String&gt; subscriber = <span class="keyword">new</span> Action1&lt;String&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">        log(s);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>我们直接把创建和订阅连接起来，完整的代码如下。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Observable.just(<span class="string">"Hello RxJava"</span>).subscribe(<span class="keyword">new</span> Action1&lt;String&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">        log(s);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>最后，使用Java 8的lambda(Android上可以使用<a href="https://github.com/evant/gradle-retrolambda" target="_blank" rel="external">Retrolambda</a>)，这个HelloWorld的最终版本如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Observable.just(<span class="string">"Hello RxJava"</span>)</div><div class="line">    .subscribe(s -&gt; log(s));</div></pre></td></tr></table></figure>
<p>##1.3 加入operator</p>
<p>很多时候，我们需要针对处理过的事件做出响应，而不仅仅是Observable产生的原始事件。由于1.1中阐述的原因，这里就需要引入operator来处理原始事件。</p>
<p>这里以一个极简单的Markdown处理为例：假设输入的是Markdown格式的文件，最终展示文字的是一个WebView，这里就需要引入一个将Markdown转为HTML的operator，其代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Observable.just(<span class="string">"#Basic Markdown to HTML"</span>).map(<span class="keyword">new</span> Func1&lt;String, String&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(s != <span class="keyword">null</span> &amp;&amp; s.startsWith(<span class="string">"#"</span>)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"&lt;h1&gt;"</span> + s.substring(<span class="number">1</span>, s.length()) + <span class="string">"&lt;/h1&gt;"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;).subscribe(s -&gt; log(s));</div></pre></td></tr></table></figure>
<p>这里使用了名为map()的operator，它的作用很简单，就是接收一个事件，并返回处理后的事件。Func1的第一个泛型参数表示输入类型，第二个繁星参数表示返回类型。</p>
<p>我们这里同样可以采用lambda来简化代码，简化后的代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Observable.just(<span class="string">"#Basic Markdown to HTML with lambda"</span>)</div><div class="line">        .map(s -&gt; s != <span class="keyword">null</span> &amp;&amp; s.startsWith(<span class="string">"#"</span>) ? <span class="string">"&lt;h1&gt;"</span> + s.substring(<span class="number">1</span>, s.length()) + <span class="string">"&lt;/h1&gt;"</span> : <span class="keyword">null</span>)</div><div class="line">        .subscribe(s -&gt; log(s));</div></pre></td></tr></table></figure></p>
<p>##1.4 Subscription</p>
<p>前三小节有意隐藏了RxJava的一个细节，实际上执行Observable.subscribe()时，它会返回一个Subscrition,它代表了Observable和Subscriber之间的关系。你可以通过Subscrition解除Observable和Subscriber之间的订阅关系，并立即停止执行整个订阅链。示例代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Subscription subscription = Observable.just(<span class="string">"Unsubscribe me later"</span>).subscribe(s -&gt; log(s));</div><div class="line">subscription.unsubscribe();</div><div class="line">log(<span class="string">"isSubscribed = "</span> + subscription.isUnsubscribed());</div></pre></td></tr></table></figure></p>
<p>#3 多线程<br>在开发过程中，为了避免阻塞UI线程，我们可能需要将某些工作放到指定线程执行。在RxJava中，你可以通过subscribeOn()来指定Observer的运行线程，通过observeOn()指定Subscriber的运行线程。这两个方法都是operator，因此它们可以像所有operator那样作用于任何的Observable。一个简单的例子如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Observable.create(<span class="keyword">new</span> Observable.OnSubscribe&lt;String&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Subscriber&lt;? <span class="keyword">super</span> String&gt; subscriber)</span> </span>&#123;</div><div class="line">        log(<span class="string">"Observable on Thread -&gt; "</span> + Thread.currentThread().getName());</div><div class="line">        subscriber.onNext(<span class="string">"MultiThreading"</span>);</div><div class="line">        subscriber.onCompleted();</div><div class="line">    &#125;</div><div class="line">&#125;).subscribeOn(Schedulers.io())</div><div class="line">        .observeOn(AndroidSchedulers.mainThread())</div><div class="line">        .subscribe(s -&gt; &#123;</div><div class="line">            log(<span class="string">"Subscriber on Thread -&gt; "</span> + Thread.currentThread().getName());</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<p>#4 错误处理<br>RxJava使用Subscriber的onError()进行错误处理。每一个Obervable的执行最后一定会调用onCompleted()和onError()方法中的一个。相比于传统的回调处理错误的方式，订阅链中任何时候出现的错误，都只需要在Subscriber的onError()方法中处理，operator不需要处理异常。</p>
<p>#5 小结</p>
<p>相比于Otto这种总线式的处理方式，RxJava对于订阅事件的处理更精细。同时，它还引入了许多函数式编程的特性，对于信息流处理有更好的解耦。目前只是通过阅读以及一些玩具代码初步了解了其用法，这仅仅是个开始。希望在实际项目中使用后，能有时间总结诸如自定义Operator等更多的高级用法。</p>
<p>##参考<br><a href="http://blog.danlew.net/2014/09/15/grokking-rxjava-part-1/" target="_blank" rel="external">Grokking RxJava</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#0.前言&lt;br&gt;本文主要记录了初步学习RxJava后的总结，希望用最短的篇幅讲清楚RxJava的主要用法。部分内容来自Dan Lew的&lt;a href=&quot;http://blog.danlew.net/2014/09/15/grokking-rxjava-part-1/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Grokking RxJava&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;本文的示例代码在&lt;a href=&quot;https://github.com/archieyang/RxJavaDemo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;#1 基本概念&lt;/p&gt;
&lt;p&gt;##1.1 Rx结构&lt;br&gt;响应式编程的主要组成部分是observable, operator和susbscriber（与Dan Lew的文章不同，这里把Operator也做为组成部分介绍，这样对结构的整体性会有更全面的认识）。&lt;br&gt;一般响应式编程的信息流如下所示：&lt;/p&gt;
&lt;p&gt;Observable -&amp;gt; Operator 1 -&amp;gt; Operator 2 -&amp;gt; Operator 3 -&amp;gt; Subscriber&lt;/p&gt;
&lt;p&gt;也就是说，observable是事件的生产者，subscriber是事件最终的消费者。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;因为subscriber通常在主线程中执行，因此设计上要求其代码尽可能简单，只对事件进行响应，而修改事件的工作全部由operator执行。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;##1.2 最简单的模式&lt;br&gt;如果我们不需要修改事件，就不需要在observable和subscriber中插入operator。这时的Rx结构如下：&lt;/p&gt;
&lt;p&gt;Obsevable -&amp;gt; Subscriber&lt;/p&gt;
&lt;p&gt;这看起来很像设计模式中的观察者模式，他们最重要的区别之一在于在没有subscriber之前，observable不会产生事件。&lt;/p&gt;
&lt;p&gt;一个简单的RxJava HelloWorld的代码如下。&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 创建observable&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Observable&amp;lt;String&amp;gt; observable = Observable.create(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Observable.OnSubscribe&amp;lt;String&amp;gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Subscriber&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; String&amp;gt; subscriber)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        subscriber.onNext(&lt;span class=&quot;string&quot;&gt;&quot;Hello RxJava&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        subscriber.onCompleted();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 创建subscriber&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Subscriber&amp;lt;String&amp;gt; subscriber = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Subscriber&amp;lt;String&amp;gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCompleted&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onError&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Throwable e)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onNext&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String s)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        log(s);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 订阅&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;observable.subscribe(subscriber);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://codethink.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://codethink.me/tags/Android/"/>
    
      <category term="RxJava" scheme="http://codethink.me/tags/RxJava/"/>
    
  </entry>
  
  <entry>
    <title>[译]Instagram是如何提升TextView渲染性能的</title>
    <link href="http://codethink.me/2015/04/23/improving-comment-rendering-on-android/"/>
    <id>http://codethink.me/2015/04/23/improving-comment-rendering-on-android/</id>
    <published>2015-04-23T11:13:01.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>原文链接: <a href="http://instagram-engineering.tumblr.com/post/114508858967/improving-comment-rendering-on-android" target="_blank" rel="external">Improving Comment Rendering on Android</a> </p>
<p>上周，成千上万来自全世界的IG用户齐聚在社区组织的先下聚会 Worldwide InstaMeet11上。WWIM11 是历史上最大，最具地域多样性的Instagram聚会，从Muscat到Bushwick，成千上万用户分享了大约10万张照片。</p>
<p>每月世界上有超过3亿用户每月使用IG，其中65%来自美国以外的国家，无论用户在哪，我们一致致力于让IG更快，更容易使用。自从去年夏天IG重新设计后，我们在继续努力提升性能。</p>
<p>我们最近的一项改进是关于渲染庞大复杂的文本以及如何通过改进它优化IG的feed滚动。我们希望你可以从我们的经验中找到提升自己app速度的方法。<br><a id="more"></a></p>
<p>#产品需求和性能问题</p>
<p>在IG中，feed是由图片，视频和文字组成的。对于每个图片和视频，我们需要展示对应的图片说明和5条最近的评论。由于用户通常通过图片说明来讲书图片背后的故事，这些图片说明通常是大段复杂的文字，甚至可能包含链接和emoji表情。<br><img src="/images/how-ig-impove-textview-rendering-1.png" alt=""><br>渲染这种复杂文本的主要问题在于它滚动时对性能的影响。在Android中，文本的渲染是很慢的。即使在一个像Nexus 5这样的新设备上，一段有十几行复杂文本的图片说明的初始绘制时间可能会达到50ms，而其文本的measure阶段就需要30ms。这些都发生在UI线程，在滚动时会导致app跳帧。</p>
<p>#使用text.Layout，缓存text.Layout<br>Android有很多用于文字展示的控件，但实际上，他们都用text.Layout进行渲染。例如，TextView会将String转化为一个text.Layout对象，并通过canvas API将它绘制到屏幕上。</p>
<p>由于text.Layout需要在构造函数中测量文本的高度，因此它的创建效率不高。缓存text.Layout和复用text.Layout实例可以节省这部分时间。Android的TextView控件并没有提供设置TextLayout的方法，但是添加一个这样的方法并不困难：</p>
<p><img src="/images/how-ig-impove-textview-rendering-2.png" alt=""></p>
<p>使用自定义的view来手动绘制text.Layout会提升其性能：TextView是一个包含大量特性的通用控件。如果我们只需要在屏幕上渲染静态的，可点击的文本，事情就简单多了：</p>
<ul>
<li><p>我们可以不用从SpannableStringBuilder转化到String。根据你的文本中是否包含链接，底层的TextView可能会复制一份你的字符串，这需要分配一些内存。</p>
</li>
<li><p>我们可以一直使用StaticLayout，这比DynamicLayout要稍微快一些。</p>
</li>
<li><p>我们可以避免使用TexView中其他的逻辑： 监听文本修改的逻辑，展示嵌入drawable的逻辑，绘制编辑器的逻辑以及弹出下拉列表的逻辑。</p>
</li>
</ul>
<p>通过使用TextLayoutView，我们可以缓存和复用text.Layout，从而避免了每次调用TextView的setText(CharSequence c)方法时都要花费20ms来创建它。</p>
<p>#下载feed后准备好Layout缓存<br>由于我们确定会在下载评论后展示他们，一个简单的改进是在下载它们后就准备好text.Layout的缓存。<br><img src="/images/how-ig-impove-textview-rendering-3.png" alt=""></p>
<p>#停止滚动后准备好TextLayoutCache<br>在可以设置text.Layout缓存后，我们的到来常数级的测量（measure）和绑定（binding）时间。但是初次绘制的时间仍然很长。50ms的绘制时间可能会导致明显的卡顿。</p>
<p>这50ms中的大部分被用于测量文本高度以及产生文字符号。这些都是CPU操作。为了提升文本渲染速度，Android在ICS中引入了TextLayoutCache用于缓存这些中间结果。TextLayoutCache是一个LRU缓存，缓存的key是文本。如果查询缓存时命中，文本的绘制速度会有很大提升。</p>
<p>在我们的测试中，这种缓存可以将绘制时间从30ms-50ms减少到2ms-6ms。<br><img src="/images/how-ig-impove-textview-rendering-4.png" alt=""><br>为了更好的提升绘制性能，我们可以在绘制文本到屏幕前准备好这个缓存。我们的思路是在一块屏幕外的canvas上虚拟的绘制这些文本。这样在我们绘制文本到屏幕前，TextLayoutCache就已经在一个背景线程中被准备好了。<br><img src="/images/how-ig-impove-textview-rendering-5.png" alt=""><br>默认情况下，TextLayoutCache的大小为0.5M，这足以缓存十几张图片的评论。我们决定在用户停止滑动时准备缓存，我们向用户滑动的方向提前缓存5个图片的评论。在任何时候，我们都至少在任何一个方向上缓存了5个图片的评论。<br><img src="/images/how-ig-impove-textview-rendering-6.png" alt=""></p>
<p>在应用了所有的这些优化后，掉帧情况减少了60%，而卡顿的情况减少了50%。我们希望这些能帮助你提升你app的速度和性能。告诉我们你的想法吧，我们期待听到你的经验。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;原文链接: &lt;a href=&quot;http://instagram-engineering.tumblr.com/post/114508858967/improving-comment-rendering-on-android&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Improving Comment Rendering on Android&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;上周，成千上万来自全世界的IG用户齐聚在社区组织的先下聚会 Worldwide InstaMeet11上。WWIM11 是历史上最大，最具地域多样性的Instagram聚会，从Muscat到Bushwick，成千上万用户分享了大约10万张照片。&lt;/p&gt;
&lt;p&gt;每月世界上有超过3亿用户每月使用IG，其中65%来自美国以外的国家，无论用户在哪，我们一致致力于让IG更快，更容易使用。自从去年夏天IG重新设计后，我们在继续努力提升性能。&lt;/p&gt;
&lt;p&gt;我们最近的一项改进是关于渲染庞大复杂的文本以及如何通过改进它优化IG的feed滚动。我们希望你可以从我们的经验中找到提升自己app速度的方法。&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://codethink.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://codethink.me/tags/Android/"/>
    
      <category term="TextView" scheme="http://codethink.me/tags/TextView/"/>
    
      <category term="Performance" scheme="http://codethink.me/tags/Performance/"/>
    
  </entry>
  
  <entry>
    <title>实现画卷式展开的TextView</title>
    <link href="http://codethink.me/2015/04/20/android-fold-textview/"/>
    <id>http://codethink.me/2015/04/20/android-fold-textview/</id>
    <published>2015-04-20T11:01:36.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>#0. 前言</p>
<p>上周朋友拿美团外卖客户端的店铺页面，问我顶部文字详情展开的实现方式，这个效果本身就是一个已经有maxline设置的TextView展开的实现，但是没有对控件的跳变做更多的处理，感觉体验不是很好。于是我先仿写一个类似效果，又在原来的基础上把跳变改成了动画，效果如图所示。<br><img src="/images/animated-flip-desc.gif" alt=""><br><a id="more"></a><br>关于这个交互设计的一点思考：之前在看一些色彩搭配的书籍时，有个观点说实际UI设计中看起来搭配的舒服的颜色，都是在自然界中可以出现的色彩搭配。同理到这个跳变，实际上是在自然界中没有什么物体有这么快的速度，因此这个速度（跳变）给人的体验并不好。</p>
<p>#1. 实现</p>
<p>##1.1 布局实现<br>布局的核心部分是图片背景及被折叠的详情文字。其实现如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">              <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">              <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">              <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">              <span class="attr">tools:context</span>=<span class="string">".MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ScrollView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">FrameLayout</span></span></div><div class="line"></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line">                <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">                    <span class="attr">android:id</span>=<span class="string">"@+id/bg"</span></div><div class="line">                    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">                    <span class="attr">android:src</span>=<span class="string">"@drawable/text_bg"</span></div><div class="line">                    <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span>/&gt;</div><div class="line">                <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">                    <span class="attr">android:id</span>=<span class="string">"@+id/content"</span></div><div class="line">                    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                    <span class="attr">android:background</span>=<span class="string">"#cc333333"</span></div><div class="line">                    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">                    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">                        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                        <span class="attr">android:layout_height</span>=<span class="string">"150dip"</span></div><div class="line">                        /&gt;</div><div class="line">                    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">                        <span class="attr">android:id</span>=<span class="string">"@+id/descriptions"</span></div><div class="line">                        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">                        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                        <span class="attr">android:layout_gravity</span>=<span class="string">"center_horizontal"</span></div><div class="line">                        <span class="attr">android:paddingLeft</span>=<span class="string">"10dip"</span></div><div class="line">                        <span class="attr">android:paddingRight</span>=<span class="string">"10dip"</span></div><div class="line">                        <span class="attr">android:textColor</span>=<span class="string">"#ffffff"</span></div><div class="line">                        <span class="attr">android:paddingTop</span>=<span class="string">"@dimen/activity_vertical_margin"</span>/&gt;</div><div class="line"></div><div class="line">                    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">                        <span class="attr">android:id</span>=<span class="string">"@+id/show_detail_button"</span></div><div class="line">                        <span class="attr">android:layout_width</span>=<span class="string">"30dip"</span></div><div class="line">                        <span class="attr">android:layout_height</span>=<span class="string">"30dip"</span></div><div class="line">                        <span class="attr">android:layout_gravity</span>=<span class="string">"bottom|center_horizontal"</span></div><div class="line">                        <span class="attr">android:src</span>=<span class="string">"@drawable/arrow_down"</span>/&gt;</div><div class="line">                <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line">            <span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"600dip"</span></div><div class="line">                <span class="attr">android:background</span>=<span class="string">"#333333"</span>&gt;<span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">ScrollView</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>由于直接设置背景对于文字展开时，图片的效果可控性很差，这里选择了使用FrameLayout将这一部分分为前景和背景。前景为包含被折叠TextView的content，背景为一个scaleType为centerCrop的ImageView。</p>
<p>##1.2 展开效果<br>位于content中的TextView在onCreate是被设置了最大行数descriptions.setMaxLines(currentLines);<br>展开时，只需要将最大行数设为Integer.MAX_VALUE即可其核心代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">showDetailButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">                currentLines = currentLines == LIMIT ? Integer.MAX_VALUE : LIMIT;</div><div class="line">                descriptions.setMaxLines(currentLines);</div><div class="line">                showDetailButton.setRotation(<span class="number">180</span> - showDetailButton.getRotation());</div><div class="line"></div><div class="line">                contentView.requestLayout();</div><div class="line"></div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<p>这里的showDetailButton.setRotation(180 - showDetailButton.getRotation());将自身翻转，使箭头反向。</p>
<p>这时点击showDetailButton，文字会全部展开，但是背景不会随文字展开而展开。因此需要在content发生变化时，通知背景ImageView进行变化，在onCreate中增加对contentView　layout 的监听。这部分的核心代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">contentView.addOnLayoutChangeListener(<span class="keyword">new</span> View.OnLayoutChangeListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLayoutChange</span><span class="params">(View view, <span class="keyword">int</span> i, <span class="keyword">int</span> i2, <span class="keyword">int</span> i3, <span class="keyword">int</span> i4, <span class="keyword">int</span> i5, <span class="keyword">int</span> i6, <span class="keyword">int</span> i7, <span class="keyword">int</span> i8)</span> </span>&#123;</div><div class="line">                bg.getLayoutParams().height = contentView.getHeight();</div><div class="line">                bg.requestLayout();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure></p>
<p>至此实现了美团外卖店铺详情的效果，完整代码在<a href="https://github.com/archieyang/FlipDesc/tree/95c2865e2e22e04646d14afb3abbe392583c41a2" target="_blank" rel="external">这里</a>，效果如下图所示。<br><img src="/images/normal-flip-desc.gif" alt=""></p>
<p>美团的效果如下图所示。<br><img src="/images/meituan-waimai.gif" alt=""></p>
<p>#2. 更好的实现<br>这一部分是我对原来效果的优化，主要包括button和详情展开两部分。</p>
<p>##2.1 Button旋转<br>在设置监听器时的代码<br>showDetailButton.setRotation(180 - showDetailButton.getRotation());比较简单粗暴，直接将箭头调转方向，这里我未showDetailButton增加了一个旋转动画，代码如下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">showDetailButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        ...</div><div class="line">        Animation animation = <span class="keyword">new</span> RotateAnimation(</div><div class="line">                currentLines == LIMIT ? <span class="number">0</span> : <span class="number">180</span>,</div><div class="line">                currentLines == LIMIT ? <span class="number">180</span> : <span class="number">360</span>,</div><div class="line">                Animation.RELATIVE_TO_SELF,</div><div class="line">                <span class="number">0.5f</span>,</div><div class="line">                Animation.RELATIVE_TO_SELF,</div><div class="line">                <span class="number">0.5f</span>);</div><div class="line"></div><div class="line">        animation.setDuration(<span class="number">300</span>);</div><div class="line">        animation.setFillAfter(<span class="keyword">true</span>);</div><div class="line">        showDetailButton.startAnimation(animation);</div><div class="line">        ...</div><div class="line"></div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><br>这里根据设置之后的TextView状态对showDetailButton进行旋转。</p>
<p>##2.2 展开动画<br>实现展开效果的expand函数如下所示，这里通过让高度随时间变化实现逐渐展开的效果。此外需要注意的是这里为动画设置了监听器。为了避免文字被卷起的边缘压到，分别在展开后和收缩前对TextView的maxLine进行修改。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">expand</span><span class="params">(<span class="keyword">final</span> View v, <span class="keyword">final</span>  <span class="keyword">float</span> originHeight, <span class="keyword">final</span> <span class="keyword">float</span> targetHeight)</span> </span>&#123;</div><div class="line">    Animation a = <span class="keyword">new</span> Animation()&#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">applyTransformation</span><span class="params">(<span class="keyword">float</span> interpolatedTime, Transformation t)</span> </span>&#123;</div><div class="line">            v.getLayoutParams().height = (<span class="keyword">int</span>)(originHeight + (targetHeight - originHeight) * interpolatedTime);</div><div class="line">            v.requestLayout();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">willChangeBounds</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    a.setDuration(<span class="number">600</span>);</div><div class="line">    a.setFillAfter(<span class="keyword">true</span>);</div><div class="line">    a.setAnimationListener(<span class="keyword">new</span> Animation.AnimationListener() &#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> maxLineDidSet = <span class="keyword">false</span>;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animation animation)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span>(currentLines == Integer.MAX_VALUE) &#123;</div><div class="line">                currentLines = LIMIT;</div><div class="line">                descriptions.setMaxLines(currentLines);</div><div class="line">                maxLineDidSet = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animation animation)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span>(!maxLineDidSet &amp;&amp; currentLines == LIMIT) &#123;</div><div class="line">                currentLines = Integer.MAX_VALUE;</div><div class="line">                descriptions.setMaxLines(currentLines);</div><div class="line">            &#125;</div><div class="line"></div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animation animation)</span> </span>&#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    v.startAnimation(a);</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure><br>下一步需要拿到TextView在收缩时和展开时的高度。在contentView.addOnLayoutChangeListener中增加获取高度的代码（初始高度设置为-1）：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">   contentView.addOnLayoutChangeListener(<span class="keyword">new</span> View.OnLayoutChangeListener() &#123;</div><div class="line">       <span class="meta">@Override</span></div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLayoutChange</span><span class="params">(View view, <span class="keyword">int</span> i, <span class="keyword">int</span> i2, <span class="keyword">int</span> i3, <span class="keyword">int</span> i4, <span class="keyword">int</span> i5, <span class="keyword">int</span> i6, <span class="keyword">int</span> i7, <span class="keyword">int</span> i8)</span> </span>&#123;</div><div class="line">...</div><div class="line">           <span class="keyword">if</span>(THUMBNAIL == -<span class="number">1</span>) &#123;</div><div class="line">               THUMBNAIL = contentView.getHeight();</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           <span class="keyword">if</span>(FULLSIZE == -<span class="number">1</span>) &#123;</div><div class="line">               FULLSIZE = THUMBNAIL + getTextViewHeight(descriptions) - descriptions.getHeight();</div><div class="line">           &#125;</div><div class="line">           ...</div><div class="line">       &#125;</div><div class="line">   &#125;);</div></pre></td></tr></table></figure></p>
<p>布局刚展示时，contentView的高度就是收缩时的高度。收缩时的高度加上TextView展开和收缩时的高度差即为展开时的contentView高度。这里的核心函数getTextViewHeight用于获取文字全部展开TextView的高度，其核心代码如下。这部分代码把TextView高度的计算分为两部分，文字高度desired和边距padding。getLineTop(n)函数返回第ｎ行顶端的位置，当n为行数时，为最后一行底部的位置。这里写成layout.getLineTop(pTextView.getLineCount())- layout.getLineTop(0)更好理解一些。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getTextViewHeight</span><span class="params">(TextView pTextView)</span> </span>&#123;</div><div class="line">    Layout layout = pTextView.getLayout();</div><div class="line">    <span class="keyword">int</span> desired = layout.getLineTop(pTextView.getLineCount());</div><div class="line">    <span class="keyword">int</span> padding = pTextView.getCompoundPaddingTop() + pTextView.getCompoundPaddingBottom();</div><div class="line">    <span class="keyword">return</span> desired + padding;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后，在设置showDetailButton监听器时，增加展开和收缩的代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">showDetailButton.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(currentLines == LIMIT) &#123;</div><div class="line">            expand(contentView, THUMBNAIL, FULLSIZE);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            expand(contentView, FULLSIZE, THUMBNAIL);</div><div class="line">        &#125;</div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>至此，对这个展开效果的优化结束，完整的代码在<a href="https://github.com/archieyang/FlipDesc" target="_blank" rel="external">这里</a>。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#0. 前言&lt;/p&gt;
&lt;p&gt;上周朋友拿美团外卖客户端的店铺页面，问我顶部文字详情展开的实现方式，这个效果本身就是一个已经有maxline设置的TextView展开的实现，但是没有对控件的跳变做更多的处理，感觉体验不是很好。于是我先仿写一个类似效果，又在原来的基础上把跳变改成了动画，效果如图所示。&lt;br&gt;&lt;img src=&quot;/images/animated-flip-desc.gif&quot; alt=&quot;&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://codethink.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://codethink.me/tags/Android/"/>
    
      <category term="TextView" scheme="http://codethink.me/tags/TextView/"/>
    
  </entry>
  
  <entry>
    <title>Philm项目源码分解析(3): Presenter与Model的设计</title>
    <link href="http://codethink.me/2015/03/27/philm-source-code-analysis-3/"/>
    <id>http://codethink.me/2015/03/27/philm-source-code-analysis-3/</id>
    <published>2015-03-27T14:20:31.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>#0. 前言<br>本文是Philm源码分析系列的第三篇，重点分析Philm MVP结构中Presenter与Model的设计。本文选取了Philm中核心的部分Movie作为示例。</p>
<p>#1.Philm中的Model<br>Philm中的Model通过State来管理，具体到Movie中，MovieController中包含一个对于MoviesState的引用。而State的实现在ApplicationState中，与第二篇提到的AndroidDisplay类似，ApplicationState是一个包含了所有Model总和的类。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationState</span> <span class="keyword">implements</span> <span class="title">BaseState</span>, <span class="title">MoviesState</span>, <span class="title">UserState</span> </span>&#123;</div><div class="line">	...</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure><br><a id="more"></a></p>
<p>#2.Presenter与Model的设计</p>
<p>##2.1 View -&gt; Presenter -&gt; Model<br>我们从一次搜索的过程来介绍各个部分的通信。SearchFragment中，mSearchView设置了一个对于搜索文本的监听器，当进行搜索时需要调用Presenter注册的回调MovieController.MovieUiCallbacks的search方法(注册回调在SearchFragment的父类BasePhilmMovieFragment中)。至此，View接受用户输入的流程结束。</p>
<p>在SearchFragment的父类BasePhilmMovieFragment中调用attachUi挂载到MovieController并在MovieController中被设置了MovieController.MovieUiCallbacks回调。</p>
<p>响应点击事件业务逻辑的MovieController.MovieUiCallbacks的search方法在MovieController(也就是Presenter)中实现。search通过ui.getMovieQueryType()拿到具体搜索的类型，之后通过fetchMovieSearchResults进行搜索。搜索最后通过FetchTmdbSearchMoviesRunnable类实现，在获取到搜索结果后，通过mMoviesState.setSearchResult(searchResult)更新Model。</p>
<p>##2.2 Model -&gt; Presenter -&gt; View<br>Model的数据被更新后，需要通过Presenter(MovieController)来更新View（Model与View不能直接通信）。Philm通知Presenter的方式是通过时间总线来实现的。这里使用的是<a href="http://square.github.io/otto/" target="_blank" rel="external">Square的otto</a>。可以看到setSearchResult中，除了将mSearchResult更新为获取的数据外，还向事件总线发送了一个SearchResultChangedEvent事件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationState</span> <span class="keyword">implements</span> <span class="title">BaseState</span>, <span class="title">MoviesState</span>, <span class="title">UserState</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSearchResult</span><span class="params">(SearchResult result)</span> </span>&#123;</div><div class="line">        mSearchResult = result;</div><div class="line">        mEventBus.post(<span class="keyword">new</span> SearchResultChangedEvent());</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure>
<p>在MovieController中，通过@Subscribe以及一个有唯一SearchResultChangedEvent的方法来接收SearchResultChangedEvent事件，最后通过populateUisFromQueryTypes更新UI。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieController</span> <span class="keyword">extends</span> <span class="title">BaseUiController</span>&lt;<span class="title">MovieController</span>.<span class="title">MovieUi</span>,</span></div><div class="line">        <span class="title">MovieController</span>.<span class="title">MovieUiCallbacks</span>&gt; &#123;</div><div class="line">    ...</div><div class="line">    <span class="meta">@Subscribe</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSearchResultChanged</span><span class="params">(MoviesState.SearchResultChangedEvent event)</span> </span>&#123;</div><div class="line">        populateUisFromQueryTypes(MovieQueryType.SEARCH, MovieQueryType.SEARCH_MOVIES,</div><div class="line">                MovieQueryType.SEARCH_PEOPLE);</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure></p>
<p>#3.最后<br>本文是Philm MVP模式分析系列的最后一篇。Philm中除了MVP模式，还有很多值得分析的地方，比如对依赖注入的使用等等，之后如果有时间会针对Philm的其他部分进行更为细致的研究。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#0. 前言&lt;br&gt;本文是Philm源码分析系列的第三篇，重点分析Philm MVP结构中Presenter与Model的设计。本文选取了Philm中核心的部分Movie作为示例。&lt;/p&gt;
&lt;p&gt;#1.Philm中的Model&lt;br&gt;Philm中的Model通过State来管理，具体到Movie中，MovieController中包含一个对于MoviesState的引用。而State的实现在ApplicationState中，与第二篇提到的AndroidDisplay类似，ApplicationState是一个包含了所有Model总和的类。&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ApplicationState&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BaseState&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;MoviesState&lt;/span&gt;, &lt;span class=&quot;title&quot;&gt;UserState&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://codethink.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://codethink.me/tags/Android/"/>
    
      <category term="MVP" scheme="http://codethink.me/tags/MVP/"/>
    
  </entry>
  
  <entry>
    <title>Philm项目源码分解析(2): View与Presenter的设计</title>
    <link href="http://codethink.me/2015/03/27/philm-source-code-analysis-2/"/>
    <id>http://codethink.me/2015/03/27/philm-source-code-analysis-2/</id>
    <published>2015-03-27T10:46:13.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>#0.前言<br>本文是Philm源码分析系列的第二篇，重点分析Philm MVP结构中View与Presenter的设计。为了便于分析，本文选取了Philm中最简单的部分About，这部分用于展示Philm的关于信息，不包含任何Model代码。</p>
<p>#1.绑定View和Presenter<br>在Philm中，View由Fragment和Activity实现，由于应用启动时首先启动Activity,因此，绑定Presenter的工作要在View中进行（也就是Activity/Fragment）。Philm在AboutFragment的onResume方法和onPause方法中进行View与Presenter的绑定与解绑。具体代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AboutFragment</span> <span class="keyword">extends</span> <span class="title">ListFragment</span>&lt;<span class="title">ListView</span>&gt;</span></div><div class="line">        <span class="keyword">implements</span> <span class="title">AboutController</span>.<span class="title">AboutListUi</span> &#123;</div><div class="line">    ...</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onResume();</div><div class="line">        getController().attachUi(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</div><div class="line">        getController().detachUi(<span class="keyword">this</span>);</div><div class="line">        <span class="keyword">super</span>.onPause();</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<p>对于Philm的About部分，它的Presenter就是MainController中的AboutController（是的，Chris Banes将Presenter命名为了Controller）。<br><a id="more"></a></p>
<p>#2.设置回调<br>下面来看Presenter(BaseUiController)中attachUi的实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseUiController</span>&lt;<span class="title">U</span> <span class="keyword">extends</span> <span class="title">BaseUiController</span>.<span class="title">Ui</span>&lt;<span class="title">UC</span>&gt;, <span class="title">UC</span>&gt;</span></div><div class="line">        <span class="keyword">extends</span> <span class="title">BaseController</span> &#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Ui</span>&lt;<span class="title">UC</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">setCallbacks</span><span class="params">(UC callbacks)</span></span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">isModal</span><span class="params">()</span></span>;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">attachUi</span><span class="params">(U ui)</span> </span>&#123;</div><div class="line">        Preconditions.checkArgument(ui != <span class="keyword">null</span>, <span class="string">"ui cannot be null"</span>);</div><div class="line">        Preconditions.checkState(!mUis.contains(ui), <span class="string">"UI is already attached"</span>);</div><div class="line"></div><div class="line">        mUis.add(ui);</div><div class="line"></div><div class="line">        ui.setCallbacks(createUiCallbacks(ui));</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (isInited()) &#123;</div><div class="line">            <span class="keyword">if</span> (!ui.isModal() &amp;&amp; !(ui <span class="keyword">instanceof</span> SubUi)) &#123;</div><div class="line">                updateDisplayTitle(getUiTitle(ui));</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            onUiAttached(ui);</div><div class="line">            populateUi(ui);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>这里最重要的两处代码是1）通过ui.setCallbacks(createUiCallbacks(ui))设置回调；和2）绘制Ui populateUi(ui)。</p>
<p>Philm在设置View回调是采用了一个非常精巧的设计：通过泛型来处理ViewInterface与回调。BaseUiController的泛型可以表示为BaseUiController<viewinterface<viewcallbacks>, ViewCallbacs&gt;，其中前一个泛型代表了前文所述用于解耦View和Presenter而实现的ViewInterface，而后一个是提供给ViewInterface的回调。ViewInterface本身提供了setCallbacks方法来进行ViewCallbacks与View的绑定。这样，所有的业务逻辑都可以在Presenter中实现，之后通过回调提供给View。View仅仅负责UI的表现，在需要处理业务逻辑时，通过调用之前Presenter设置的回调实现。</viewinterface<viewcallbacks></p>
<p>这里可以看一下About中响应List中某个item被点击的实现。这里onListItemClick继承自ListFragment<listview>，用于响应某个item的点击事件，AboutFragment将这个事件交给了Presenter设置的回调来处理。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AboutFragment</span> <span class="keyword">extends</span> <span class="title">ListFragment</span>&lt;<span class="title">ListView</span>&gt;</span></div><div class="line">        <span class="keyword">implements</span> <span class="title">AboutController</span>.<span class="title">AboutListUi</span> &#123;</div><div class="line">    ...</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onListItemClick</span><span class="params">(ListView l, View v, <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span> </span>&#123;</div><div class="line">        AboutController.AboutItem item = (AboutController.AboutItem) l.getItemAtPosition(position);</div><div class="line">        <span class="keyword">if</span> (item != <span class="keyword">null</span> &amp;&amp; hasCallbacks()) &#123;</div><div class="line">            getCallbacks().onItemClick(item);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure></listview></p>
<p>#3.Display<br>这是Philm中一处比较新颖的设计，它本身应该算是Presenter的一部分，具体的实现在AndroidDisplay这个类中。它的作用是负责app中<strong>所有</strong>UI切换的工作，比如Activity跳转，现实Fragment，弹出Drawer等。听起来很不可以思议，但是由于这些代码都很短小，实际上这个类并不大，也不复杂。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#0.前言&lt;br&gt;本文是Philm源码分析系列的第二篇，重点分析Philm MVP结构中View与Presenter的设计。为了便于分析，本文选取了Philm中最简单的部分About，这部分用于展示Philm的关于信息，不包含任何Model代码。&lt;/p&gt;
&lt;p&gt;#1.绑定View和Presenter&lt;br&gt;在Philm中，View由Fragment和Activity实现，由于应用启动时首先启动Activity,因此，绑定Presenter的工作要在View中进行（也就是Activity/Fragment）。Philm在AboutFragment的onResume方法和onPause方法中进行View与Presenter的绑定与解绑。具体代码如下：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AboutFragment&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ListFragment&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;ListView&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AboutController&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;AboutListUi&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onResume&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onResume();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        getController().attachUi(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onPause&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        getController().detachUi(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onPause();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;对于Philm的About部分，它的Presenter就是MainController中的AboutController（是的，Chris Banes将Presenter命名为了Controller）。&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://codethink.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://codethink.me/tags/Android/"/>
    
      <category term="MVP" scheme="http://codethink.me/tags/MVP/"/>
    
  </entry>
  
  <entry>
    <title>Philm项目源码分解析(1): 基本概念</title>
    <link href="http://codethink.me/2015/03/26/philm-source-code-analysis-1/"/>
    <id>http://codethink.me/2015/03/26/philm-source-code-analysis-1/</id>
    <published>2015-03-26T10:54:57.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>#0. 前言</p>
<p>Watch Philm这一系列文章主要是对近期阅读Chris Banes的开源项目Philm源码的整理。Android开发本身没有提供类似MVP之类的框架，只是提供了构建应用的基础组件。这一方面降低了上手难度，提供了极大的开发时的灵活度，但是对于新手极易写出高耦合的坏味道的代码。Philm本身构建了一套MVP架构的实现，本文也就基于Philm项目的源码来分析在Android开发中如何利用MVP模式构建程序。</p>
<p>本文为这个系列的第一篇，重点介绍MVC,MVP以及MVVM架构的基本概念以及他们的区别。<br><a id="more"></a></p>
<p>#1. MVC<br>MVC是一个传统的主流UI框架，现在的MVC框架经过演变主要分为两种。</p>
<p>第一种是传统的MVC框架，如下图所示。传统的MVC框架使用了一个长期存在的View和一个可更换的Controller。例如，在一个登录界面，根据用户是否已经登录，可能会有不同的Controller来响应。</p>
<p>由于传统MVC框架中保留一个长期存在的View，所有的用户交互都要通过这个View实现，它对于前端开发是一个极为有效的模式。<br><img src="/images/mvc.png" alt=""></p>
<p>另一种MVC被称为Model2 MVC，如图所示。有争论说Model2并不是一个完全的MVC框架，但是大多数的现代实现（比如Ruby on Rails）都把它归为MVC。<br><img src="/images/model2_mvc.png" alt=""><br><strong>Model2的聪明之处在于它要求”fat models and thin controllers”，也就是讲更多的代码放入Model中，而不是Controller中。由于需要监听并响应View的输入，传统的MVC更倾向于重型Controller（也就是使Controller容纳更多的业务逻辑）。</strong></p>
<p>由于HTTP协议本身是无状态的，在不同的请求之间View本身并不需要保存其状态。大多数服务器端开发框架都使用Session Cookies保存应用程序状态，因此他们将Controller和View的通信设计为单项的就十分恰当了，但是这并不适用于前端框架。实际上，很多框架的Controller被精简为一个简单的路由机制。</p>
<p>#2. MVP<br>MVP模式是一种分化的MVC，相比于传统的MVC模式的不同之处在于：</p>
<p>1）View不能直接于Model通信；</p>
<p>2）Presenter包含对View的引用，并根据Model的变化来更新View。</p>
<p><img src="/images/mvp.png" alt=""></p>
<p>MVP模式主要有两种实现：</p>
<p>1）Passive View: View被设计的尽可能简单，所有的表现和业务逻辑都放在Presenter中实现。</p>
<p>2）Supervising Controller： View中可以包含简单的逻辑。View中无法满足的业务逻辑才放在Presenter中实现。</p>
<p>在Android的MVP实现里通常包含4个要素</p>
<p>(1) View: 负责绘制UI元素、与用户进行交互(Activity或Fragment);</p>
<p>(2) View interface: View需要实现的接口，View通过View interface与Presenter进行交互，降低耦合，方便进行单元测试</p>
<p>(3) Model: 负责业务Bean的操作。</p>
<p>(4) Presenter: 作为View与Model交互的纽带，承载了大部分的复杂逻辑。</p>
<p>#3. MVVM<br><img src="/images/mvvm.png" alt=""><br>Model-View-ViewModel模式于MVP模式极为类似，二者最大的不同在于MVVM假设ViewModel(相当于MVP中的Presenter)中的变化会被自动反应到View中，这种双向绑定并不需要开发者维护，而是基于框架提供了数据绑定引擎实现。Angular 1.x就是基于MVVM模式实现的。</p>
<p>#参考资料</p>
<ol>
<li><a href="http://blog.nodejitsu.com/scaling-isomorphic-javascript-code/" target="_blank" rel="external">http://blog.nodejitsu.com/scaling-isomorphic-javascript-code/</a></li>
<li><a href="http://blog.csdn.net/vector_yi/article/details/24719873" target="_blank" rel="external">http://blog.csdn.net/vector_yi/article/details/24719873</a></li>
<li><a href="http://www.cnblogs.com/indream/p/3602348.html" target="_blank" rel="external">http://www.cnblogs.com/indream/p/3602348.html</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#0. 前言&lt;/p&gt;
&lt;p&gt;Watch Philm这一系列文章主要是对近期阅读Chris Banes的开源项目Philm源码的整理。Android开发本身没有提供类似MVP之类的框架，只是提供了构建应用的基础组件。这一方面降低了上手难度，提供了极大的开发时的灵活度，但是对于新手极易写出高耦合的坏味道的代码。Philm本身构建了一套MVP架构的实现，本文也就基于Philm项目的源码来分析在Android开发中如何利用MVP模式构建程序。&lt;/p&gt;
&lt;p&gt;本文为这个系列的第一篇，重点介绍MVC,MVP以及MVVM架构的基本概念以及他们的区别。&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://codethink.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://codethink.me/tags/Android/"/>
    
      <category term="MVP" scheme="http://codethink.me/tags/MVP/"/>
    
  </entry>
  
  <entry>
    <title>DroidWorks: 在ActionBar中嵌入TabBar</title>
    <link href="http://codethink.me/2014/09/14/embedded-tab-bar/"/>
    <id>http://codethink.me/2014/09/14/embedded-tab-bar/</id>
    <published>2014-09-14T11:02:09.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>#前言<br>Android中默认的TabBar位于ActionBar的下方，在ActionBar横屏有足够空间时，会将TabBar嵌入到ActionBar中，节省纵向空间。一些UI设计强制将TabBar嵌入到ActionBar，并去掉默认的HOME LOGO，起到节省屏幕空间的作用，如网易云音乐2.1.1中。</p>
<p><img src="/images/netease-cloud-music.png" alt=""><br><a id="more"></a></p>
<p>#1. ViewPager+Tabs实现侧滑</p>
<p>##实现ViewPager</p>
<p>##关联ViewPager与Tabs<br>这部分代码在Google官方的Training中有详细的阐述（<a href="http://developer.android.com/training/implementing-navigation/lateral.html" target="_blank" rel="external">Creating Swipe Views with Tabs</a>），这里就不详细解释了，它实现的这个侧滑和Tab联动的交互是上文所述效果的基础。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.codethink.embeddedtabsactionbar;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.ActionBar;</div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.app.Fragment;</div><div class="line"><span class="keyword">import</span> android.app.FragmentManager;</div><div class="line"><span class="keyword">import</span> android.graphics.Color;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v13.app.FragmentStatePagerAdapter;</div><div class="line"><span class="keyword">import</span> android.support.v4.view.ViewPager;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.LayoutInflater;</div><div class="line"><span class="keyword">import</span> android.view.Menu;</div><div class="line"><span class="keyword">import</span> android.view.MenuItem;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.ViewGroup;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.lang.reflect.Method;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> TabContentPagerAdapter mTabContentPagerAdapter;</div><div class="line">    <span class="keyword">private</span> ViewPager mViewPager;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> ActionBar actionBar = getActionBar();</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line"></div><div class="line">        mTabContentPagerAdapter = <span class="keyword">new</span> TabContentPagerAdapter(getFragmentManager());</div><div class="line">        mViewPager = (ViewPager) findViewById(R.id.pager);</div><div class="line">        mViewPager.setAdapter(mTabContentPagerAdapter);</div><div class="line"></div><div class="line">        mViewPager.setOnPageChangeListener(<span class="keyword">new</span> ViewPager.SimpleOnPageChangeListener()&#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">                actionBar.setSelectedNavigationItem(position);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        actionBar.setNavigationMode(ActionBar.NAVIGATION_MODE_TABS);</div><div class="line"></div><div class="line">        ActionBar.TabListener tabListener = <span class="keyword">new</span> ActionBar.TabListener() &#123;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabSelected</span><span class="params">(ActionBar.Tab tab, android.app.FragmentTransaction fragmentTransaction)</span> </span>&#123;</div><div class="line">                mViewPager.setCurrentItem(tab.getPosition());</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabUnselected</span><span class="params">(ActionBar.Tab tab, android.app.FragmentTransaction fragmentTransaction)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabReselected</span><span class="params">(ActionBar.Tab tab, android.app.FragmentTransaction fragmentTransaction)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</div><div class="line">            actionBar.addTab(</div><div class="line">                    actionBar.newTab()</div><div class="line">                            .setText(<span class="string">"Tab "</span> + (i + <span class="number">1</span>))</div><div class="line">                            .setTabListener(tabListener));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</div><div class="line">        </div><div class="line">        <span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span></div><div class="line">        getMenuInflater().inflate(R.menu.main, menu);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</div><div class="line">        <span class="comment">// Handle action bar item clicks here. The action bar will</span></div><div class="line">        <span class="comment">// automatically handle clicks on the Home/Up button, so long</span></div><div class="line">        <span class="comment">// as you specify a parent activity in AndroidManifest.xml.</span></div><div class="line">        <span class="keyword">int</span> id = item.getItemId();</div><div class="line">        <span class="keyword">if</span> (id == R.id.action_settings) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TabContentPagerAdapter</span> <span class="keyword">extends</span> <span class="title">FragmentStatePagerAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TabContentPagerAdapter</span><span class="params">(FragmentManager fm)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(fm);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Fragment <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">            Fragment fragment = <span class="keyword">new</span> DemoObjectFragment();</div><div class="line">            Bundle args = <span class="keyword">new</span> Bundle();</div><div class="line">            <span class="keyword">switch</span> (i) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="number">0</span>:</div><div class="line">                    args.putInt(DemoObjectFragment.ARG_OBJECT, Color.RED);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">                    args.putInt(DemoObjectFragment.ARG_OBJECT, Color.YELLOW);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">                    args.putInt(DemoObjectFragment.ARG_OBJECT, Color.BLUE);</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            fragment.setArguments(args);</div><div class="line">            <span class="keyword">return</span> fragment;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">3</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> CharSequence <span class="title">getPageTitle</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"OBJECT "</span> + (position + <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoObjectFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ARG_OBJECT = <span class="string">"object"</span>;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater,</span></span></div><div class="line">                                 ViewGroup container, Bundle savedInstanceState) &#123;</div><div class="line"></div><div class="line">            View rootView = inflater.inflate(</div><div class="line">                    R.layout.fragment_main, container, <span class="keyword">false</span>);</div><div class="line">            Bundle args = getArguments();</div><div class="line">            rootView.setBackgroundColor(args.getInt(ARG_OBJECT));</div><div class="line">            <span class="keyword">return</span> rootView;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<p>效果如下：</p>
<p><img src="/images/viewpager-and-tabs.png" alt=""></p>
<p>#2. 嵌入TabBar到ActionBar<br>通过反射机制强制嵌入TabBar是实现这个效果的核心部分，其代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">......</div><div class="line"></div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</div><div class="line">          actionBar.addTab(</div><div class="line">                  actionBar.newTab()</div><div class="line">                          .setText(<span class="string">"Tab "</span> + (i + <span class="number">1</span>))</div><div class="line">                          .setTabListener(tabListener));</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      enableEmbeddedTabs(actionBar);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">enableEmbeddedTabs</span><span class="params">(Object actionBar)</span> </span>&#123;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">          Method setHasEmbeddedTabsMethod = actionBar.getClass().getDeclaredMethod(<span class="string">"setHasEmbeddedTabs"</span>, <span class="keyword">boolean</span>.class);</div><div class="line">          setHasEmbeddedTabsMethod.setAccessible(<span class="keyword">true</span>);</div><div class="line">          setHasEmbeddedTabsMethod.invoke(actionBar, <span class="keyword">true</span>);</div><div class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">          Log.v(<span class="string">"EmbeddedTabs"</span>, e.getMessage().toString());</div><div class="line"></div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="/images/raw-embedded-tabs.png" alt=""></p>
<p>#3. 修改ActionBar样式</p>
<p>##3.1 删除左侧默认的App Logo<br>通过设置定制的ActionBar style中的displayOptions为none可以去掉左侧默认的Logo<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- Base application theme. --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"android:Theme.Holo.Light"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="comment">&lt;!-- Customize your theme here. --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:actionBarStyle"</span>&gt;</span>@style/EmbeddedActionBar<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"EmbeddedActionBar"</span> <span class="attr">parent</span>=<span class="string">"@android:style/Widget.Holo.Light.ActionBar.Solid"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:displayOptions"</span>&gt;</span>none<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>##3.2 修改TabBar样式<br>这一部分主要包括三个步骤</p>
<p>1.修改Tab前景</p>
<p>2.修改Tab背景</p>
<p>3.去掉TabBar的divider</p>
<p>###3.2.1 修改Tab前景<br>Tab前景主要是icon被选中时候颜色的改变，这里icon在选中的时候为绿色，未选中为白色，通过selector建立对应的Tab前景样式如下（这里以tag这个标签为例）：<br><code>actionbar_tag.xml</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- Selected states --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/actionbar_tag_green"</span> <span class="attr">android:state_focused</span>=<span class="string">"false"</span> <span class="attr">android:state_pressed</span>=<span class="string">"false"</span> <span class="attr">android:state_selected</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- Focused states --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/actionbar_tag_green"</span> <span class="attr">android:state_focused</span>=<span class="string">"true"</span> <span class="attr">android:state_pressed</span>=<span class="string">"false"</span> <span class="attr">android:state_selected</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/actionbar_tag_green"</span> <span class="attr">android:state_focused</span>=<span class="string">"true"</span> <span class="attr">android:state_pressed</span>=<span class="string">"false"</span> <span class="attr">android:state_selected</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- Pressed --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/actionbar_tag_green"</span> <span class="attr">android:state_pressed</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/actionbar_tag_white"</span> <span class="attr">android:state_focused</span>=<span class="string">"false"</span> <span class="attr">android:state_pressed</span>=<span class="string">"false"</span> <span class="attr">android:state_selected</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>将三个前景图作为数组写到arrays.xml<br><code>arrays.xml</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"actionbar_icons"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>@drawable/actionbar_home<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>@drawable/actionbar_tag<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>@drawable/actionbar_account<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>在onCreate函数中设置Tab的前景：<br><code>MainActivity.java</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">......</div><div class="line"></div><div class="line">        TypedArray iconIds = getResources().obtainTypedArray(R.array.actionbar_icons);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</div><div class="line">            View view = getLayoutInflater().inflate(R.layout.actionbar_tab_layout, <span class="keyword">null</span>);</div><div class="line">            ImageView imageView = (ImageView) view.findViewById(R.id.icon);</div><div class="line">            imageView.setImageResource(iconIds.getResourceId(i, -<span class="number">1</span>));</div><div class="line"></div><div class="line">            actionBar.addTab(</div><div class="line">                    actionBar.newTab()</div><div class="line">                            .setCustomView(view)</div><div class="line">                            .setTabListener(tabListener));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        enableEmbeddedTabs(actionBar);</div><div class="line">......</div></pre></td></tr></table></figure><br>这里的action_tab_layout如下<br><code>action_tab_layout.xml</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">        &gt;</div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span> <span class="attr">android:id</span>=<span class="string">"@+id/icon"</span></span></div><div class="line">               <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></div><div class="line">               <span class="attr">android:layout_width</span>=<span class="string">"50dp"</span></div><div class="line">               <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span>/&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>在styles.xml中设置Tab的padding和gravity<br><code>styles.xml</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- Base application theme. --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"android:Theme.Holo.Light"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="comment">&lt;!-- Customize your theme here. --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:actionBarStyle"</span>&gt;</span>@style/EmbeddedActionBar<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:actionBarTabStyle"</span>&gt;</span>@style/EmbeddedTabStyle<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"EmbeddedActionBar"</span> <span class="attr">parent</span>=<span class="string">"@android:style/Widget.Holo.Light.ActionBar.Solid"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:displayOptions"</span>&gt;</span>none<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"EmbeddedTabStyle"</span> <span class="attr">parent</span>=<span class="string">"@android:style/Widget.Holo.Light.ActionBar.TabView"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:padding"</span>&gt;</span>0dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:gravity"</span>&gt;</span>center<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div><div class="line"></div></pre></td></tr></table></figure><br>修改后的样式如下：</p>
<p><img src="/images/front-tab-styled.png" alt=""></p>
<p>###3.2.2 设置Tab背景<br>Tab的背景是指Tab选中时，背景色随之改变的样式，同样通过selector实现，实现xml如下：</p>
<p><code>actionbar_tabs_bg.xml</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- Selected states --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@color/actionbar_selected"</span> <span class="attr">android:state_focused</span>=<span class="string">"false"</span> <span class="attr">android:state_pressed</span>=<span class="string">"false"</span> <span class="attr">android:state_selected</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- Focused states --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@color/actionbar_selected"</span> <span class="attr">android:state_focused</span>=<span class="string">"true"</span> <span class="attr">android:state_pressed</span>=<span class="string">"false"</span> <span class="attr">android:state_selected</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@color/actionbar_selected"</span> <span class="attr">android:state_focused</span>=<span class="string">"true"</span> <span class="attr">android:state_pressed</span>=<span class="string">"false"</span> <span class="attr">android:state_selected</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- Pressed --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@color/actionbar_selected"</span> <span class="attr">android:state_pressed</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@android:color/transparent"</span> <span class="attr">android:state_focused</span>=<span class="string">"false"</span> <span class="attr">android:state_pressed</span>=<span class="string">"false"</span> <span class="attr">android:state_selected</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></div><div class="line"></div></pre></td></tr></table></figure><br>在Tab的样式中指定background为actionbar_tags_bg.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">......</div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"EmbeddedTabStyle"</span> <span class="attr">parent</span>=<span class="string">"@android:style/Widget.Holo.Light.ActionBar.TabView"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:background"</span>&gt;</span>@drawable/actionbar_tabs_bg<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:padding"</span>&gt;</span>0dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:gravity"</span>&gt;</span>center<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line">......</div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div><div class="line"></div></pre></td></tr></table></figure></p>
<p>###3.2.3删除TabBar的divider<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- Base application theme. --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"android:Theme.Holo.Light"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="comment">&lt;!-- Customize your theme here. --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:actionBarStyle"</span>&gt;</span>@style/EmbeddedActionBar<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:actionBarTabStyle"</span>&gt;</span>@style/EmbeddedTabStyle<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:actionBarTabBarStyle"</span>&gt;</span>@style/customActionBarTabBarStyle<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">......</div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"customActionBarTabBarStyle"</span> <span class="attr">parent</span>=<span class="string">"@android:style/Widget.Holo.Light.ActionBar.TabBar"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:divider"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div><div class="line"></div></pre></td></tr></table></figure></p>
<p>###3.2.4 修改ActionBar颜色</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">......</div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"EmbeddedActionBar"</span> <span class="attr">parent</span>=<span class="string">"@android:style/Widget.Holo.Light.ActionBar.Solid"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:displayOptions"</span>&gt;</span>none<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:background"</span>&gt;</span>@color/actionbar_dark_grey<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">...... </div></pre></td></tr></table></figure>
<p>最终完成后效果如下：</p>
<p><img src="/images/styled-embedded-tabs.gif" alt=""></p>
<p>代码地址：<br><a href="https://github.com/archieyang/EmbeddedTabsActionBar" target="_blank" rel="external">EmbeddedTabsActionBar</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#前言&lt;br&gt;Android中默认的TabBar位于ActionBar的下方，在ActionBar横屏有足够空间时，会将TabBar嵌入到ActionBar中，节省纵向空间。一些UI设计强制将TabBar嵌入到ActionBar，并去掉默认的HOME LOGO，起到节省屏幕空间的作用，如网易云音乐2.1.1中。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/netease-cloud-music.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Android" scheme="http://codethink.me/categories/Android/"/>
    
    
      <category term="Android" scheme="http://codethink.me/tags/Android/"/>
    
      <category term="TabBar" scheme="http://codethink.me/tags/TabBar/"/>
    
  </entry>
  
  <entry>
    <title>Idiomatic Python: Strings, Conditions and Tests</title>
    <link href="http://codethink.me/2014/08/09/idiomatic-python-strings-conditions-tests/"/>
    <id>http://codethink.me/2014/08/09/idiomatic-python-strings-conditions-tests/</id>
    <published>2014-08-09T13:16:48.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>##Concatenating strings<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">names = [<span class="string">'raymond'</span>, <span class="string">'rachel'</span>, <span class="string">'matthew'</span>, <span class="string">'roger'</span>,</div><div class="line">         <span class="string">'betty'</span>, <span class="string">'melissa'</span>, <span class="string">'judith'</span>, <span class="string">'charlie'</span>]</div><div class="line"></div><div class="line"><span class="comment">#NOT SO GOOD</span></div><div class="line">s = names[<span class="number">0</span>]</div><div class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names[<span class="number">1</span>:]:</div><div class="line">    s += <span class="string">', '</span> + name</div><div class="line"><span class="keyword">print</span> s</div><div class="line"></div><div class="line"><span class="comment">#GOOD</span></div><div class="line"><span class="keyword">print</span> <span class="string">', '</span>.join(names)</div></pre></td></tr></table></figure><br><a id="more"></a></p>
<p>##EAFP is preferable to LBYL<br>“It’s <strong>E</strong>asier to <strong>A</strong>sk for <strong>F</strong>orgiveness than <strong>P</strong>ermission.”</p>
<p>“<strong>L</strong>ook <strong>B</strong>efore <strong>Y</strong>ou <strong>L</strong>eap.”</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">d = &#123;<span class="string">'x'</span>: <span class="string">'5'</span>&#125;</div><div class="line"></div><div class="line"><span class="comment">#NOT SO GOOD</span></div><div class="line"><span class="keyword">if</span> <span class="string">'x'</span> <span class="keyword">in</span> d <span class="keyword">and</span> isinstance(d[<span class="string">'x'</span>], str) <span class="keyword">and</span> d[<span class="string">'x'</span>].isdigit():</div><div class="line">    value = int(d[<span class="string">'x'</span>])</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    value = <span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="comment"># GOOD</span></div><div class="line"><span class="keyword">try</span>:</div><div class="line">    value = int(d[<span class="string">'x'</span>])</div><div class="line"><span class="keyword">except</span> (KeyError, TypeError, ValueError):</div><div class="line">    value = <span class="keyword">None</span></div></pre></td></tr></table></figure>
<p>Throwing exceptions is <strong>not</strong> “expensive” in Python unlike e.g. Java.<br>Rely on duck typing rather than checking for a specific type.</p>
<p>##Use truthy and falsy values</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">name = <span class="string">'Safe'</span></div><div class="line">pets = [<span class="string">'Dog'</span>, <span class="string">'Cat'</span>, <span class="string">'Hamster'</span>]</div><div class="line">owners = &#123;<span class="string">'Safe'</span>: <span class="string">'Cat'</span>, <span class="string">'George'</span>: <span class="string">'Dog'</span>&#125;</div><div class="line"></div><div class="line"><span class="comment"># NOT SO GOOD</span></div><div class="line"><span class="keyword">if</span> name != <span class="string">''</span> <span class="keyword">and</span> len(pets) &gt; <span class="number">0</span> <span class="keyword">and</span> owners != &#123;&#125;:</div><div class="line">    print(<span class="string">'We have pets!'</span>)</div><div class="line"></div><div class="line"><span class="comment"># GOOD</span></div><div class="line"><span class="keyword">if</span> name <span class="keyword">and</span> pets <span class="keyword">and</span> owners:</div><div class="line">    print(<span class="string">'We have pets!'</span>)</div></pre></td></tr></table></figure>
<p>##Use pdb</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pdb</div><div class="line">pdb.set_trace()</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;##Concatenating strings&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;names = [&lt;span class=&quot;string&quot;&gt;&#39;raymond&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;rachel&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;matthew&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;roger&#39;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;string&quot;&gt;&#39;betty&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;melissa&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;judith&#39;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&#39;charlie&#39;&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#NOT SO GOOD&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;s = names[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; name &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; names[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;:]:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    s += &lt;span class=&quot;string&quot;&gt;&#39;, &#39;&lt;/span&gt; + name&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; s&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#GOOD&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;, &#39;&lt;/span&gt;.join(names)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Python" scheme="http://codethink.me/categories/Python/"/>
    
    
      <category term="Python" scheme="http://codethink.me/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Idiomatic Python: Improve Clarity</title>
    <link href="http://codethink.me/2014/08/09/idiomatic-python-improve-clarity/"/>
    <id>http://codethink.me/2014/08/09/idiomatic-python-improve-clarity/</id>
    <published>2014-08-09T12:36:24.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>##Clarify function calls with keyword arguments<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#NOT SO GOOD</span></div><div class="line">twitter_search(<span class="string">'@obama'</span>, <span class="keyword">False</span>, <span class="number">20</span>, <span class="keyword">True</span>)</div><div class="line"></div><div class="line"><span class="comment">#GOOD</span></div><div class="line">twitter_search(<span class="string">'@obama'</span>, retweets=<span class="keyword">False</span>, numtweets=<span class="number">20</span>,popular=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><br><a id="more"></a></p>
<p>##Clarify multiple return values with named tuples<br><code>namedtuple</code> is a factory function for creating tuple subclasses with named fields.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#NOT SO GOOD</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment">#some test here</span></div><div class="line">    attempted = <span class="number">4</span></div><div class="line">    failed = <span class="number">0</span></div><div class="line">    <span class="keyword">return</span> failed, attempted<span class="comment"># -&gt; (0, 4)</span></div><div class="line"></div><div class="line"><span class="comment">#GOOD</span></div><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</div><div class="line"></div><div class="line">TestResult = namedtuple(<span class="string">'TestResult'</span>, [<span class="string">'failed'</span>, <span class="string">'attempt'</span>])</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment">#some test here</span></div><div class="line">    attempted = <span class="number">4</span></div><div class="line">    failed = <span class="number">0</span></div><div class="line">    <span class="keyword">return</span> TestResult(failed, attempted)<span class="comment"># -&gt; TestResults(failed=0, attempted=4)</span></div></pre></td></tr></table></figure>
<p>##Unpacking sequences<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">p = <span class="string">'Raymond'</span>, <span class="string">'Hettinger'</span>, <span class="number">0x30</span>, <span class="string">'python@example.com'</span></div><div class="line"></div><div class="line"><span class="comment"># NOT SO GOOD</span></div><div class="line">fname = p[<span class="number">0</span>]</div><div class="line">lname = p[<span class="number">1</span>]</div><div class="line">age = p[<span class="number">2</span>]</div><div class="line">email = p[<span class="number">3</span>]</div><div class="line"></div><div class="line"><span class="comment">#GOOD</span></div><div class="line">fname, lname, age, email = p</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;##Clarify function calls with keyword arguments&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#NOT SO GOOD&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;twitter_search(&lt;span class=&quot;string&quot;&gt;&#39;@obama&#39;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#GOOD&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;twitter_search(&lt;span class=&quot;string&quot;&gt;&#39;@obama&#39;&lt;/span&gt;, retweets=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;, numtweets=&lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;,popular=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Python" scheme="http://codethink.me/categories/Python/"/>
    
    
      <category term="Python" scheme="http://codethink.me/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Idiomatic Python: Dictionaries</title>
    <link href="http://codethink.me/2014/08/09/idiomatic-python-dictionaries/"/>
    <id>http://codethink.me/2014/08/09/idiomatic-python-dictionaries/</id>
    <published>2014-08-09T03:19:12.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>##Dict comprehension<br>Dict comprehensions can be used to create dictionaries from arbitrary key and value expressions:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;x: x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> (<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>)&#125;</div><div class="line">&#123;<span class="number">2</span>: <span class="number">4</span>, <span class="number">4</span>: <span class="number">16</span>, <span class="number">6</span>: <span class="number">36</span>&#125;</div></pre></td></tr></table></figure><br><a id="more"></a></p>
<p>##Loop over dictionary keys<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">d = &#123;<span class="string">'matthew'</span>: <span class="string">'blue'</span>, <span class="string">'rachel'</span>: <span class="string">'green'</span>, <span class="string">'raymond'</span>:<span class="string">'red'</span>&#125;</div><div class="line"></div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> d:</div><div class="line">    <span class="keyword">print</span> k</div><div class="line"></div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> d.keys():</div><div class="line">    <span class="keyword">if</span> k.startswith(<span class="string">'r'</span>):</div><div class="line">        <span class="keyword">del</span> d[k]</div><div class="line">        </div><div class="line">d = &#123;k: d[k] <span class="keyword">for</span> k <span class="keyword">in</span> d <span class="keyword">if</span> <span class="keyword">not</span> k.startswith(<span class="string">'r'</span>)&#125;</div></pre></td></tr></table></figure></p>
<p>##Loop over a dictionary keys and values<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#NOT SO GOOD</span></div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> d:</div><div class="line">    <span class="keyword">print</span> k, <span class="string">' -&gt; '</span>, d[k]</div><div class="line"></div><div class="line"><span class="comment">#BETTER</span></div><div class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> d.items():</div><div class="line">    <span class="keyword">print</span> k, <span class="string">' -&gt; '</span>, v</div><div class="line"></div><div class="line"><span class="comment">#BEST</span></div><div class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> d.iteritems():</div><div class="line">    <span class="keyword">print</span> k, <span class="string">' -&gt; '</span>, v</div></pre></td></tr></table></figure></p>
<p>##Construct a dictionary from pairs<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> izip</div><div class="line"></div><div class="line">names = [<span class="string">'raymond'</span>, <span class="string">'rachel'</span>, <span class="string">'matthew'</span>]</div><div class="line">colors = [<span class="string">'red'</span>, <span class="string">'green'</span>, <span class="string">'blue'</span>]</div><div class="line"></div><div class="line">d = dict(izip(names, colors))</div><div class="line">&#123;<span class="string">'matthew'</span>: <span class="string">'blue'</span>, <span class="string">'rachel'</span>: <span class="string">'green'</span>, <span class="string">'raymond'</span>: <span class="string">'red'</span>&#125;</div><div class="line"></div><div class="line">d = dict(enumerate(names))</div><div class="line">&#123;<span class="number">0</span>: <span class="string">'raymond'</span>, <span class="number">1</span>: <span class="string">'rachel'</span>, <span class="number">2</span>: <span class="string">'matthew'</span>&#125;</div></pre></td></tr></table></figure></p>
<p>##Counting with dict<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">colors = [<span class="string">'red'</span>, <span class="string">'green'</span>, <span class="string">'red'</span>, <span class="string">'blue'</span>, <span class="string">'green'</span>, <span class="string">'red'</span>]</div><div class="line"></div><div class="line"><span class="comment">#NOT SO GOOD</span></div><div class="line">d = &#123;&#125;</div><div class="line"><span class="keyword">for</span> color <span class="keyword">in</span> colors:</div><div class="line">    <span class="keyword">if</span> color <span class="keyword">not</span> <span class="keyword">in</span> d:</div><div class="line">        d[color] = <span class="number">0</span></div><div class="line">    d[color] += <span class="number">1</span></div><div class="line">&#123;<span class="string">'blue'</span>: <span class="number">1</span>, <span class="string">'green'</span>: <span class="number">2</span>, <span class="string">'red'</span>: <span class="number">3</span>&#125;</div><div class="line"></div><div class="line"><span class="comment">#BETTER</span></div><div class="line">d = &#123;&#125;</div><div class="line"><span class="keyword">for</span> color <span class="keyword">in</span> colors:</div><div class="line">    d[color] = d.get(color, <span class="number">0</span>) + <span class="number">1</span></div><div class="line"></div><div class="line"><span class="comment">#BEST</span></div><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</div><div class="line">d = defaultdict(int)</div><div class="line"><span class="keyword">for</span> color <span class="keyword">in</span> colors:</div><div class="line">    d[color] += <span class="number">1</span></div></pre></td></tr></table></figure></p>
<p>##Grouping with dict<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#NOT SO GOOD</span></div><div class="line">d = &#123;&#125;</div><div class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names:</div><div class="line">    key = len(name)</div><div class="line">    <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> d:</div><div class="line">        d[key] = []</div><div class="line">    d[key].append(name)</div><div class="line">&#123;<span class="number">5</span>: [<span class="string">'roger'</span>, <span class="string">'betty'</span>], <span class="number">6</span>: [<span class="string">'rachel'</span>, <span class="string">'judith'</span>],</div><div class="line"> <span class="number">7</span>: [<span class="string">'raymond'</span>, <span class="string">'matthew'</span>, <span class="string">'melissa'</span>, <span class="string">'charlie'</span>]&#125;</div><div class="line"></div><div class="line"><span class="comment">#BETTER</span></div><div class="line">d = &#123;&#125;</div><div class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names:</div><div class="line">    key = len(name)</div><div class="line">    d.setdefault(key, []).append(name)</div><div class="line"></div><div class="line"><span class="comment">#BEST</span></div><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</div><div class="line">d = defaultdict(list)</div><div class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names:</div><div class="line">    key = len(name)</div><div class="line">    d[key].append(name)</div></pre></td></tr></table></figure></p>
<p>##Use popitem<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">d = &#123;<span class="string">'matthew'</span>: <span class="string">'blue'</span>, <span class="string">'rachel'</span>: <span class="string">'green'</span>, <span class="string">'raymond'</span>:<span class="string">'red'</span>&#125;</div><div class="line"></div><div class="line"><span class="keyword">while</span> d:</div><div class="line">    key, value = d.popitem()</div><div class="line">    <span class="keyword">print</span> key, <span class="string">'--&gt;'</span>, value</div></pre></td></tr></table></figure></p>
<p>##Linking dictionaries<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">defaults = &#123;<span class="string">'color'</span>: <span class="string">'red'</span>, <span class="string">'user'</span>: <span class="string">'guest'</span>&#125;</div><div class="line"></div><div class="line">parser = argparse.ArgumentParser()</div><div class="line">parser.add_argument(<span class="string">'-u'</span>, <span class="string">'--user'</span>)</div><div class="line">parser.add_argument(<span class="string">'-c'</span>, <span class="string">'--color'</span>)</div><div class="line">namespace = parser.parse_args([])</div><div class="line">command_line_args = &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> vars(namespace).items() <span class="keyword">if</span> v&#125;</div><div class="line"></div><div class="line"><span class="comment">#NOT SO GOOD</span></div><div class="line">d = defaults.copy()</div><div class="line">d.update(os.environ)</div><div class="line">d.update(command_line_args)</div><div class="line"></div><div class="line"><span class="comment">#GOOD(ONLY FOR PYTHON 3)</span></div><div class="line">d = ChainMap(command_line_args, os.environ, defaults)</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;##Dict comprehension&lt;br&gt;Dict comprehensions can be used to create dictionaries from arbitrary key and value expressions:&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&amp;#123;x: x**&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; x &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; (&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;)&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;36&lt;/span&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Python" scheme="http://codethink.me/categories/Python/"/>
    
    
      <category term="Python" scheme="http://codethink.me/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Idiomatic Python: Lists</title>
    <link href="http://codethink.me/2014/08/09/idiomatic-python-lists/"/>
    <id>http://codethink.me/2014/08/09/idiomatic-python-lists/</id>
    <published>2014-08-09T03:07:31.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>##List Comprehension<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]</div><div class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>) <span class="keyword">if</span> i%<span class="number">2</span> == <span class="number">0</span>]</div><div class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">18</span>]</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>fruit = [<span class="string">"Apples"</span>, <span class="string">"Peaches"</span>, <span class="string">"Pears"</span>, <span class="string">"Bananas"</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> [(i,f) <span class="keyword">for</span> i <span class="keyword">in</span> nums <span class="keyword">for</span> f <span class="keyword">in</span> fruit]</div><div class="line">[(<span class="number">1</span>, <span class="string">'Apples'</span>), (<span class="number">1</span>, <span class="string">'Peaches'</span>), (<span class="number">1</span>, <span class="string">'Pears'</span>), (<span class="number">1</span>, <span class="string">'Bananas'</span>),</div><div class="line"> (<span class="number">2</span>, <span class="string">'Apples'</span>), (<span class="number">2</span>, <span class="string">'Peaches'</span>), (<span class="number">2</span>, <span class="string">'Pears'</span>), (<span class="number">2</span>, <span class="string">'Bananas'</span>),</div><div class="line"> (<span class="number">3</span>, <span class="string">'Apples'</span>), (<span class="number">3</span>, <span class="string">'Peaches'</span>), (<span class="number">3</span>, <span class="string">'Pears'</span>), (<span class="number">3</span>, <span class="string">'Bananas'</span>),</div><div class="line"> (<span class="number">4</span>, <span class="string">'Apples'</span>), (<span class="number">4</span>, <span class="string">'Peaches'</span>), (<span class="number">4</span>, <span class="string">'Pears'</span>), (<span class="number">4</span>, <span class="string">'Bananas'</span>)]</div><div class="line"> </div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> [(i,f) <span class="keyword">for</span> i <span class="keyword">in</span> nums <span class="keyword">for</span> f <span class="keyword">in</span> fruit <span class="keyword">if</span> f[<span class="number">0</span>] == <span class="string">"P"</span>]</div><div class="line">[(<span class="number">1</span>, <span class="string">'Peaches'</span>), (<span class="number">1</span>, <span class="string">'Pears'</span>),</div><div class="line"> (<span class="number">2</span>, <span class="string">'Peaches'</span>), (<span class="number">2</span>, <span class="string">'Pears'</span>),</div><div class="line"> (<span class="number">3</span>, <span class="string">'Peaches'</span>), (<span class="number">3</span>, <span class="string">'Pears'</span>),</div><div class="line"> (<span class="number">4</span>, <span class="string">'Peaches'</span>), (<span class="number">4</span>, <span class="string">'Pears'</span>)]</div><div class="line"> </div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> [(i,f) <span class="keyword">for</span> i <span class="keyword">in</span> nums <span class="keyword">for</span> f <span class="keyword">in</span> fruit <span class="keyword">if</span> f[<span class="number">0</span>] == <span class="string">"P"</span> <span class="keyword">if</span> i%<span class="number">2</span> == <span class="number">1</span>]</div><div class="line">[(<span class="number">1</span>, <span class="string">'Peaches'</span>), (<span class="number">1</span>, <span class="string">'Pears'</span>), (<span class="number">3</span>, <span class="string">'Peaches'</span>), (<span class="number">3</span>, <span class="string">'Pears'</span>)]</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> [i <span class="keyword">for</span> i <span class="keyword">in</span> zip(nums,fruit) <span class="keyword">if</span> i[<span class="number">0</span>]%<span class="number">2</span>==<span class="number">0</span>]</div><div class="line">[(<span class="number">2</span>, <span class="string">'Peaches'</span>), (<span class="number">4</span>, <span class="string">'Bananas'</span>)]</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;##List Comprehension&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;
    
    </summary>
    
      <category term="Python" scheme="http://codethink.me/categories/Python/"/>
    
    
      <category term="Python" scheme="http://codethink.me/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Idiomatic Python: Loops</title>
    <link href="http://codethink.me/2014/08/09/idiomatic-python-loops/"/>
    <id>http://codethink.me/2014/08/09/idiomatic-python-loops/</id>
    <published>2014-08-09T01:06:37.000Z</published>
    <updated>2017-05-28T03:01:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>##Use xrange instead of tranditional index manipulation<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># NOT SO GOOD</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]:</div><div class="line">    <span class="keyword">print</span> i * <span class="number">2</span></div><div class="line"></div><div class="line"><span class="comment">#BETTER</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</div><div class="line">    <span class="keyword">print</span> i*<span class="number">2</span></div><div class="line"></div><div class="line"><span class="comment">#BEST</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">6</span>):</div><div class="line">    <span class="keyword">print</span> i*<span class="number">2</span></div></pre></td></tr></table></figure><br><a id="more"></a></p>
<p>##Use reverse to loop backwards<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">colors = [<span class="string">'red'</span>, <span class="string">'green'</span>, <span class="string">'blue'</span>, <span class="string">'yellow'</span>]</div><div class="line"></div><div class="line"><span class="comment">#NOT SO GOOD</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(colors)<span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>):</div><div class="line">    <span class="keyword">print</span> colors[i]</div><div class="line"></div><div class="line"><span class="comment">#GOOD</span></div><div class="line"><span class="keyword">for</span> color <span class="keyword">in</span> reversed(colors):</div><div class="line">    <span class="keyword">print</span> color</div></pre></td></tr></table></figure></p>
<p>##Use enumerate to loop over a collection and indices#2. List<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">colors = [<span class="string">'red'</span>, <span class="string">'green'</span>, <span class="string">'blue'</span>, <span class="string">'yellow'</span>]</div><div class="line"></div><div class="line"><span class="comment">#NOT SO GOOD</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(colors)):</div><div class="line">    <span class="keyword">print</span> i, <span class="string">" -&gt; "</span>, colors[i]</div><div class="line">    </div><div class="line"><span class="comment">#GOOD</span></div><div class="line"><span class="keyword">for</span> i, color <span class="keyword">in</span> enumerate(colors):</div><div class="line">    <span class="keyword">print</span> i, <span class="string">" -&gt; "</span>, colors[i]</div></pre></td></tr></table></figure></p>
<p>##Use izip to loop over two collections<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">colors = [<span class="string">'red'</span>, <span class="string">'green'</span>, <span class="string">'blue'</span>, <span class="string">'yellow'</span>]</div><div class="line">names = [<span class="string">'Archie'</span>, <span class="string">'Ben'</span>, <span class="string">'Chris'</span>, <span class="string">'Dave'</span>]</div><div class="line"></div><div class="line"><span class="comment">#NOT SO GOOD</span></div><div class="line">n = min(len(colors), len(names))</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(n):</div><div class="line">    <span class="keyword">print</span> colors[i], <span class="string">' -&gt; '</span>, names[i]</div><div class="line"></div><div class="line"><span class="comment">#BETTER</span></div><div class="line"><span class="keyword">for</span> name, color <span class="keyword">in</span> zip(names, colors):</div><div class="line">    <span class="keyword">print</span> color, <span class="string">' -&gt; '</span>, name</div><div class="line"></div><div class="line"><span class="comment">#BEST</span></div><div class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> izip</div><div class="line"><span class="keyword">for</span> name, color <span class="keyword">in</span> izip(names, colors):</div><div class="line">    <span class="keyword">print</span> color, <span class="string">' -&gt; '</span>, name</div></pre></td></tr></table></figure></p>
<p>##Use sorted to loop in sorted order<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">colors = [<span class="string">'red'</span>, <span class="string">'green'</span>, <span class="string">'blue'</span>, <span class="string">'yellow'</span>]</div><div class="line"></div><div class="line"><span class="comment">#NORMAL</span></div><div class="line"><span class="keyword">for</span> color <span class="keyword">in</span> sorted(colors):</div><div class="line">    <span class="keyword">print</span> color</div><div class="line"></div><div class="line"><span class="comment">#REVERSE</span></div><div class="line"><span class="keyword">for</span> color <span class="keyword">in</span> sorted(colors, reversed=<span class="keyword">True</span>):</div><div class="line">    <span class="keyword">print</span> color</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#CUSTOM COMPARATOR</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare_length</span><span class="params">(c1, c2)</span>:</span></div><div class="line">    <span class="keyword">if</span> len(c1) &lt; len(c2):</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span></div><div class="line">    <span class="keyword">if</span> len(c1) &gt; len(c2):</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span></div><div class="line"></div><div class="line"><span class="keyword">print</span> sorted(colors, cmp=compare_length())</div><div class="line"><span class="keyword">print</span> sorted(colors, key=len)</div></pre></td></tr></table></figure></p>
<p>##Use for…else… to distinguish multiple exit points in loops<br>The “else” here is better explained by “no break”.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#NOT SO GOOD</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(seq, target)</span>:</span></div><div class="line">    found = <span class="keyword">False</span></div><div class="line">    <span class="keyword">for</span> i, value <span class="keyword">in</span> enumerate(seq):</div><div class="line">        <span class="keyword">if</span> value == target:</div><div class="line">            found = <span class="keyword">True</span></div><div class="line">            <span class="keyword">break</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found:</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span></div><div class="line">    <span class="keyword">return</span> i</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#GOOD</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(seq, target)</span>:</span></div><div class="line">    <span class="keyword">for</span> i, value <span class="keyword">in</span> enumerate(seq):</div><div class="line">        <span class="keyword">if</span> value == target:</div><div class="line">            <span class="keyword">break</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span></div><div class="line">    <span class="keyword">return</span> i</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;##Use xrange instead of tranditional index manipulation&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# NOT SO GOOD&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; [&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;]:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; i * &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#BETTER&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; range(&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; i*&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#BEST&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; xrange(&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; i*&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Python" scheme="http://codethink.me/categories/Python/"/>
    
    
      <category term="Python" scheme="http://codethink.me/tags/Python/"/>
    
  </entry>
  
</feed>
